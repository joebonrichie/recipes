#
# SPDX-FileCopyrightText: Â© 2020-2025 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : buildah
version     : 1.42.2
release     : 3
upstreams   :
    - https://github.com/containers/buildah/archive/refs/tags/v1.42.2.tar.gz : 784dfcf050d55c011aaf4e7247b1465259c41c861ff455dc754d6159121cab1e
homepage    : https://buildah.io/
license     : Apache-2.0 AND BSD-2-Clause AND BSD-3-Clause AND ISC AND MIT AND MPL-2.0
summary     : A command line tool used for creating OCI Images
description : |
    The buildah package provides a command line tool which can be used to
    * create a working container from scratch
    or
    * create a working container from an image as a starting point
    * mount/umount a working container's root file system for manipulation
    * save container's root file system layer to create a new image
    * delete a working container or an image
builddeps   :
    - binary(go)
    - binary(go-md2man)
    - pkgconfig(gpgme)
    - pkgconfig(libseccomp)
    - pkgconfig(sqlite3)
    - pkgconfig(systemd)
    - shadow-devel
rundeps     :
    - binary(passt)
    - binary(runc)
    - binary(skopeo)
build       : |
    export CGO_LDFLAGS="${LDFLAGS}"
    export CGO_CFLAGS="${CFLAGS}"
    export CGO_CPPFLAGS="${CPPFLAGS}"
    export CGO_CXXFLAGS="${CXXFLAGS}"

    export BUILDTAGS="containers_image_ostree_stub libsqlite3 libsubid seccomp systemd"

    # The containers/image prefix has changed domain names so in order to ensure that we use the correct setting regardless of which one is used just use both
    %make PREFIX="%(prefix)" \
        GOFLAGS="-buildmode=pie -trimpath" \
        EXTRA_LDFLAGS="-X github.com/containers/image/v5/signature.systemDefaultPolicyPath=%(vendordir)/containers/policy.json \
                       -X go.podman.io/image/v5/signature.systemDefaultPolicyPath=%(vendordir)/containers/policy.json"
install     : |
    %make_install PREFIX="%(prefix)" install.completions
