#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : fish
version     : 4.3.3
release     : 18
homepage    : https://fishshell.com/
upstreams   :
    - https://github.com/fish-shell/fish-shell/releases/download/4.3.3/fish-4.3.3.tar.xz : eba0e7d325c1d46046bb9d29434e7e0dabf7f584eb156845005d688e10b86e57
summary     : The friendly interactive shell
description : |
    fish is a smart and user-friendly command line shell for macOS, Linux, and the rest of the family. fish includes features like syntax highlighting, autosuggest-as-you-type, and fancy tab completions that just work, with no configuration required.
license     : GPL-2.0-only
networking  : true
builddeps   :
    - binary(man)
    - binary(msgfmt)
    - binary(sphinx-build)
    - pkgconfig(libpcre2-32)
# checkdeps   :
#     - procps-ng
#     - python
setup       : |
    %patch %(pkgdir)/0001-downstream-Update-default-PATH.patch

    %cargo_fetch
    %cmake
build       : |
    %cmake_build
install     : |
    %cmake_install

    # preconfigured to work with aeryn so bash can stay as login shell
    # (less work in terms of having env-var dropins and what not)
    %install_dir %(installroot)%(vendordir)/profile.d/
    %install_file %(pkgdir)/99-exec-fish-as-interactive-shell.conf %(installroot)%(vendordir)/profile.d/
    
    %tmpfiles "# Fish shell directories"
    %tmpfiles "d /etc/fish/completions 0755 root root -"
    %tmpfiles "d /etc/fish/conf.d 0755 root root -"
    %tmpfiles "d /etc/fish/functions 0755 root root -"

    # Cleanup
    rm -rfv %(installroot)/usr/etc

# Tests 91 and 156 currently fail, TODO fix them
# check       : |
#     %make test
packages    :
    - "%(name)-docs":
        paths:
            - /usr/share/doc/*
