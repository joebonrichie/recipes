From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Reilly Brogan <reilly@reillybrogan.com>
Date: Mon, 22 Sep 2025 14:02:17 -0500
Subject: [PATCH] Revert "expand: Move stop array closer to strpbrk call"

This reverts commit e878137f63e61926bbdff7062a558f0143ed5872.
---
 src/expand.c | 17 +++++++----------
 1 file changed, 7 insertions(+), 10 deletions(-)

diff --git a/src/expand.c b/src/expand.c
index 992cbe8..2f63a92 100644
--- a/src/expand.c
+++ b/src/expand.c
@@ -1882,6 +1882,9 @@ static __attribute__((noinline)) int ccmatch(char *p, const char *mbc, int ml,
 
 static int pmatch(char *pattern, const char *string)
 {
+    /* stop should be null-terminated as it passed as a string to
+     * strpbrk. */
+	char stop[] = { 0, CTLESC, CTLMBCHAR, '\0' };
 	const char *q;
 	unsigned mb;
 	char *p;
@@ -1911,17 +1914,11 @@ static int pmatch(char *pattern, const char *string)
 				c = *++p;
 			if (!c)
 				return 1;
-			if (c == '?' || c != '[')
-				c = CTLESC;
+			stop[0] = CTLESC;
+			if (c != '?' && c != '[')
+				stop[0] = c;
 			for (;;) {
-				if (c != CTLESC) {
-					/* Stop should be null-terminated
-					 * as it is passed as a string to
-					 * strpbrk(3).
-					 */
-					const char stop[] = {
-						c, CTLESC, CTLMBCHAR, 0,
-					};
+				if (stop[0] != (char)CTLESC) {
 					q = strpbrk(q, stop);
 					if (!q)
 						return 0;
