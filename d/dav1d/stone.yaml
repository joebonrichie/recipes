#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : dav1d
version     : 1.5.2
release     : 4
homepage    : https://code.videolan.org/videolan/dav1d
upstreams   :
    - https://code.videolan.org/videolan/dav1d/-/archive/1.5.2/dav1d-1.5.2.tar.bz2 : c748a3214cf02a6d23bc179a0e8caea9d6ece1e46314ef21f5508ca6b5de6262
    - https://code.videolan.org/videolan/dav1d-test-data/-/archive/1.5.2/dav1d-test-data-1.5.2.tar.gz :
        hash: f422da0d78d8e059ca55726952bb9a1a5e0c3310d4bfb3adec29d137ddf6b5d5
        rename: dav1d-test-data.tar.gz
        unpack: false
summary     : AV1 decoder targeted to be small and fast
description : |
    dav1d is a new AV1 cross-platform Decoder, open-source, and focused on speed and correctness.
license     : BSD-2-Clause
builddeps   :
    - binary(nasm)
    - pkgconfig(libxxhash)
tuning      :
    - lto: full
setup       : |
    mkdir tests/dav1d-test-data
    bsdtar-static -xf %(sourcedir)/dav1d-test-data.tar.gz --strip-components=1 -C tests/dav1d-test-data
    %meson \
        -Dtestdata_tests=true
build       : |
    %meson_build
install     : |
    %meson_install
check       : |
    # The dependency ordering for this is slightly broken, and this needs to be built before tests can run
    meson compile tests/checkasm -C %(builddir)

    %meson_test
packages    :
    - "lib%(name)":
        summary: Library files for dav1d
        description: |
            Library files for dav1d, the AV1 cross-platform Decoder
        paths:
            - /usr/lib/libdav1d.so.*
