#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : dav1d
version     : 1.5.3
release     : 5
homepage    : https://code.videolan.org/videolan/dav1d
upstreams   :
    - https://code.videolan.org/videolan/dav1d/-/archive/1.5.3/dav1d-1.5.3.tar.bz2 : e099f53253f6c247580c554d53a13f1040638f2066edc3c740e4c2f15174ce22
    - https://code.videolan.org/videolan/dav1d-test-data/-/archive/1.5.3/dav1d-test-data-1.5.3.tar.gz :
        hash: 71a44413995d1827a394befa82af601254b1be9e09deb70be7d53d8006409b18
        rename: dav1d-test-data.tar.gz
        unpack: false
summary     : AV1 decoder targeted to be small and fast
description : |
    dav1d is a new AV1 cross-platform Decoder, open-source, and focused on speed and correctness.
license     : BSD-2-Clause
builddeps   :
    - binary(nasm)
    - pkgconfig(libxxhash)
tuning      :
    - lto: full
setup       : |
    mkdir tests/dav1d-test-data
    bsdtar-static -xf %(sourcedir)/dav1d-test-data.tar.gz --strip-components=1 -C tests/dav1d-test-data

    %meson \
        -Dtestdata_tests=true
build       : |
    %meson_build
install     : |
    %meson_install
check       : |
    # The dependency ordering for this is slightly broken, and this needs to be built before tests can run
    meson compile tests/checkasm -C %(builddir)

    %meson_test
packages    :
    - "lib%(name)":
        summary: Library files for dav1d
        description: |
            Library files for dav1d, the AV1 cross-platform Decoder
        paths:
            - /usr/lib/libdav1d.so.*
