#
# SPDX-FileCopyrightText: Â© 2020-2025 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : waydroid
version     : 1.6.1
release     : 3
homepage    : https://waydro.id/
upstreams   :
    - https://github.com/waydroid/waydroid/archive/1.6.1/waydroid-1.6.1.tar.gz : f81ae0281701942a8beb749397a4fa8ce828c2dc727878b44d1385e23a921bcd
license     : Apache-2.0
summary     : Run Android apps on GNU/Linux
description : |
    Container-based approach to boot a full Android system on GNU/Linux
rundeps     :
    - binary(dnsmasq)
    - sysbinary(nft)
    - lxc
    - python(dbus-python)
    - python(gbinder-python)
    - python(pyclip)
setup       : |
    %patch %(pkgdir)/0001-Service-tweaks.patch
install     : |
    %make_install \
        USE_NFTABLES=1 \
        APPS_MENU_DIR=/usr/share/xdg/menus/applications-merged
    %python_compile

    # The service is dbus-activated, so preset it as disabled so it only starts upon request
    %install_file %(pkgdir)/waydroid.preset -t %(installroot)/%(libdir)/systemd/system-preset
    %install_file %(pkgdir)/waydroid-pre.service -t %(installroot)/%(libdir)/systemd/system
    %install_file %(pkgdir)/dev-binderfs.mount -t %(installroot)/%(libdir)/systemd/system

    # Fix directory permissions
    find %(installroot) -type d -exec chmod 755 {} +
