From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Reilly Brogan <reilly@reillybrogan.com>
Date: Fri, 19 Sep 2025 19:52:34 -0500
Subject: [PATCH] Fix fmt 12.0 build

---
 src/modules/simpleclock.cpp | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/src/modules/simpleclock.cpp b/src/modules/simpleclock.cpp
index b6a96ecc..5f60d32d 100644
--- a/src/modules/simpleclock.cpp
+++ b/src/modules/simpleclock.cpp
@@ -1,5 +1,6 @@
 #include "modules/simpleclock.hpp"
 
+#include <chrono>
 #include <time.h>
 
 waybar::modules::Clock::Clock(const std::string& id, const Json::Value& config)
@@ -17,8 +18,17 @@ waybar::modules::Clock::Clock(const std::string& id, const Json::Value& config)
 auto waybar::modules::Clock::update() -> void {
   tzset();  // Update timezone information
   auto now = std::chrono::system_clock::now();
+#if (FMT_VERSION >= 110200)
+  auto localtime = std::chrono::system_clock::to_time_t(now);
+  std::tm aslocal;
+  if (!localtime_r(&localtime, &aslocal)) {
+    throw fmt::format_error("time_t value out of range");
+  }
+  auto text = fmt::format(fmt::runtime(format_), aslocal);
+#else
   auto localtime = fmt::localtime(std::chrono::system_clock::to_time_t(now));
   auto text = fmt::format(fmt::runtime(format_), localtime);
+#endif
   label_.set_markup(text);
 
   if (tooltipEnabled()) {
