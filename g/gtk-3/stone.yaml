#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : gtk-3
version     : 3.24.51
release     : 15
homepage    : https://gtk.org
upstreams   :
    - https://download.gnome.org/sources/gtk/3.24/gtk-3.24.51.tar.xz : 0013877c6bd23c2dbe42ad7c70a053d0e449be66736574e37867c49c5f905a4f
summary     : Develop applications and user interfaces with GTK+
description : |
    Develop applications and user interfaces with GTK+
license     :
    - LGPL-2.0-or-later
    - LGPL-2.1-or-later
builddeps   :
    - binary(cmake)
    - binary(msgfmt)
    - binary(sassc)
    - binary(wayland-scanner)
    - binary(xsltproc)
    - pkgconfig(atk)
    - pkgconfig(atk-bridge-2.0)
    - pkgconfig(cairo)
    - pkgconfig(cairo-gobject)
    - pkgconfig(cloudproviders)
    - pkgconfig(colord)
    - pkgconfig(cups)
    - pkgconfig(epoxy)
    - pkgconfig(fontconfig)
    - pkgconfig(freetype2)
    - pkgconfig(fribidi)
    - pkgconfig(gdk-pixbuf-2.0)
    - pkgconfig(gio-unix-2.0)
    - pkgconfig(glib-2.0)
    - pkgconfig(gmodule-2.0)
    - pkgconfig(gobject-2.0)
    - pkgconfig(gobject-introspection-1.0)
    - pkgconfig(harfbuzz)
    - pkgconfig(iso-codes)
    - pkgconfig(libpng)
    - pkgconfig(pango)
    - pkgconfig(pangocairo)
    - pkgconfig(pangoft2)
    - pkgconfig(shared-mime-info)
    - pkgconfig(sysprof-capture-4)
    - pkgconfig(tracker-sparql-3.0)
    - pkgconfig(wayland-client)
    - pkgconfig(wayland-cursor)
    - pkgconfig(wayland-egl)
    - pkgconfig(wayland-protocols)
    - pkgconfig(x11)
    - pkgconfig(xcomposite)
    - pkgconfig(xcursor)
    - pkgconfig(xdamage)
    - pkgconfig(xext)
    - pkgconfig(xfixes)
    - pkgconfig(xi)
    - pkgconfig(xinerama)
    - pkgconfig(xkbcommon)
    - pkgconfig(xrandr)
    - pkgconfig(xrender)
    - docbook
    - docbook-xsl
environment : |
    %export_docbook_catalogs
setup       : |
    %patch %(pkgdir)/0001-Allow-disabling-legacy-Tracker-search.patch

    # https://gitlab.gnome.org/GNOME/glib/-/issues/1833
    export CFLAGS+=" -DG_DISABLE_CAST_CHECKS"

    # TODO:
    # - Should we set Adwaita as the default font like Arch?
    %meson \
        -Dbuiltin_immodules=wayland,waylandgtk \
        -Dcloudproviders=true \
        -Dman=true \
        -Dprofiler=true \
        -Dtracker=false \
        -Dtracker3=true
build       : |
    %meson_build
install     : |
    %meson_install
    %install_file %(pkgdir)/icon-cache.yaml %(installroot)/usr/share/moss/triggers/tx.d/gtk3_update_icon_cache.yaml
    %install_file %(pkgdir)/immodules.yaml %(installroot)/usr/share/moss/triggers/tx.d/gtk3_query_immodules.yaml
packages    :
    - "%(name)":
        rundeps     :
            - "%(name)-update-icon-cache"
            - adwaita-icon-theme # Standard icons
            - gobject-introspection # The gobject introspection data in this package depends on at least xlib-2.0.typelib
            - gsettings-desktop-schemas
        paths:
            - /usr/bin/gtk-launch
            - /usr/bin/gtk-query-immodules-3.0
            - /usr/share/moss/triggers/tx.d/gtk3_query_immodules.yaml

    - "%(name)-devel":
        paths:
            - /usr/bin/gtk-builder-tool
            - /usr/bin/gtk-encode-symbolic-svg
            - /usr/bin/gtk-query-settings
            - /usr/share/gettext/
            - /usr/share/gtk-3.0/gtkbuilder.rng
            - /usr/share/gtk-3.0/valgrind/gtk.supp
            - /usr/share/man/man1/gtk-builder-tool.1*
            - /usr/share/man/man1/gtk-encode-symbolic-svg.1*
            - /usr/share/man/man1/gtk-query-settings.1*

    - "%(name)-demos":
        summary: Demonstrations of GTK3 toolkit
        description: Demonstration of GTK3 toolkit
        paths:
            - /usr/bin/gtk3-*
            - /usr/share/glib-2.0/schemas/org.gtk.Demo.gschema.xml
            - /usr/share/glib-2.0/schemas/org.gtk.exampleapp.gschema.xml
            - /usr/share/applications/
            - /usr/share/icons/hicolor/
            - /usr/share/man/man1/gtk3-*

    - "%(name)-update-icon-cache":
        summary: Update icon caches
        description: Update icon cavhes
        paths:
            - /usr/bin/gtk-update-icon-cache
            - /usr/share/man/man1/gtk-update-icon-cache.1*
            - /usr/share/moss/triggers/tx.d/gtk3_update_icon_cache.yaml
