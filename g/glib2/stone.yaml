#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : glib2
version     : 2.86.1
release     : 32
homepage    : https://gitlab.gnome.org/GNOME/glib
upstreams   :
    - https://download.gnome.org/sources/glib/2.86/glib-2.86.1.tar.xz : 119d1708ca022556d6d2989ee90ad1b82bd9c0d1667e066944a6d0020e2d5e57
summary     : Low-level core library that forms the basis for projects such as GTK+ and GNOME
description : |
    GLib is the low-level core library that forms the basis for projects such
    as GTK and GNOME. It provides data structure handling for C, portability
    wrappers, and interfaces for such runtime functionality as an event loop,
    threads, dynamic loading, and an object system.
license     :
    - Apache-2.0
    - CC0-1.0
    - GPL-2.0-or-later
    - LGPL-2.1-or-later
    - LLVM-exception
    - MIT
builddeps   :
    - binary(rst2man)
    - binary(xgettext)
    # - binary(xsltproc)
    - pkgconfig(bash-completion)
    - pkgconfig(gobject-introspection-1.0)
    - pkgconfig(sysprof-capture-4)
    - pkgconfig32(libelf)
    - pkgconfig32(libffi)
    - pkgconfig32(libpcre2-8)
    - pkgconfig32(mount)
    - pkgconfig32(zlib)
    - python-packaging
emul32      : true
environment : |
    export CFLAGS="${CFLAGS} -Wno-error=missing-include-dirs"
profiles    :
    - emul32:
        setup: |
            %patch %(pkgdir)/0001-glib-gutils-Support-stateless-fallback-XDG_CONFIG_DI.patch
            %patch %(pkgdir)/0001-gdesktopappinfo-Support-ptyxis-for-executing-.deskto.patch
            %meson \
                -Dinstalled_tests=false \
                -Dintrospection=disabled \
                -Dsysprof=disabled \
                -Dtests=false
        build: |
            %meson_build
        install: |
            %meson_install
setup       : |
    %patch %(pkgdir)/0001-glib-gutils-Support-stateless-fallback-XDG_CONFIG_DI.patch
    %patch %(pkgdir)/0001-gdesktopappinfo-Support-ptyxis-for-executing-.deskto.patch

    %meson \
        -Dinstalled_tests=false \
        -Dman-pages=true \
        -Dtests=false
build       : |
    %meson_build
install     : |
    %meson_install
    %python_compile
    %install_file %(pkgdir)/trigger.yaml %(installroot)/usr/share/moss/triggers/tx.d/glib2.yaml
    %install_file %(pkgdir)/glibconfig.h %(installroot)%(includedir)/glib-2.0/glibconfig.h
packages    :
    - "%(name)-32bit-devel":
        paths:
            - /usr/share/gdb/auto-load/usr/lib32
            - /usr/lib32/glib-2.0/include

    - "%(name)-devel":
        rundeps:
            - binary(python3)
            - python(packaging)
        paths:
            - /usr/bin/gdbus-codegen
            - /usr/bin/gi-compile-repository
            - /usr/bin/gi-decompile-typelib
            - /usr/bin/gi-inspect-typelib
            - /usr/bin/glib-compile-resources
            - /usr/bin/glib-genmarshal
            - /usr/bin/glib-gettextize
            - /usr/bin/glib-mkenums
            - /usr/bin/gobject-query
            - /usr/bin/gresource
            - /usr/bin/gtester
            - /usr/bin/gtester-report
            - /usr/share/bash-completion/completions/gresource
            - /usr/share/gdb/auto-load/usr/lib
            - /usr/share/gettext/
            - /usr/share/glib-2.0/codegen/
            - /usr/share/glib-2.0/dtds
            - /usr/share/glib-2.0/gdb
            - /usr/share/glib-2.0/gettext
            - /usr/share/glib-2.0/schemas
            - /usr/share/glib-2.0/valgrind
            - /usr/lib/glib-2.0/include
            - /usr/share/man/man1/gdbus-codegen.1*
            - /usr/share/man/man1/gi-compile-repository.1*
            - /usr/share/man/man1/gi-decompile-typelib.1*
            - /usr/share/man/man1/gi-inspect-typelib.1*
            - /usr/share/man/man1/glib-compile-resources.1*
            - /usr/share/man/man1/glib-genmarshal.1*
            - /usr/share/man/man1/glib-gettextize.1*
            - /usr/share/man/man1/glib-mkenums.1*
            - /usr/share/man/man1/gobject-query.1*
            - /usr/share/man/man1/gresource.1*
            - /usr/share/man/man1/gtester-report.1*
            - /usr/share/man/man1/gtester.1*
