#
# SPDX-FileCopyrightText: Â© 2020-2025 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : vscode-bin
version     : 1.104.1
release     : 12
upstreams   :
    - https://vscode.download.prss.microsoft.com/dbazure/download/stable/0f0d87fa9e96c856c5212fc86db137ac0d783365/code-stable-x64-1758154038.tar.gz:
        hash: cb4063af19a9ec3615e225039d0182d1a218ad034cde83e271a8db795b84b6a7

    - https://raw.githubusercontent.com/microsoft/vscode/1.104.1/resources/linux/code.desktop:
        hash: 2f1782b30c4e040efff655fd9cf477930c5a0c81ddae27749b0cbb922c1d248e
        unpack: false

    - https://raw.githubusercontent.com/microsoft/vscode/1.104.1/resources/linux/code-url-handler.desktop:
        hash: c361efa7e02fcad759ed80d2fbab67877f33219b981578af6fffaf18aeb12d9b
        unpack: false

    - https://raw.githubusercontent.com/microsoft/vscode/1.104.1/resources/linux/code-workspace.xml:
        hash: 3af748dd6578a1775e8eb7248ba397b7e11840df2ea6ee234ff76fee3dc306cf
        unpack: false
homepage    : https://code.visualstudio.com/
license     : Distributable
summary     : Visual Studio Code (vscode) - Editor for building and debugging modern web and cloud applications (official binary version)
description : |
    Visual Studio Code (vscode) - Editor for building and debugging modern web and cloud applications (official binary version)
rundeps     :
    - ca-certificates
    - binary(git)
 # Causes extension signature validation to fail
debug       : false
strip       : false
environment : |
    function meta_info() {
        sed 's/@@NAME_LONG@@/Visual Studio Code/g' "$1" |\
        sed 's/@@NAME_SHORT@@/Code/g' |\
        sed 's/@@NAME@@/code/g' |\
        sed 's#@@EXEC@@#/usr/bin/code#g' |\
        sed 's/@@ICON@@/visual-studio-code/g' |\
        sed 's/@@URLPROTOCOL@@/vscode/g'
    }
install     : |
    export vsdir=%(libdir)/vscode
    %install_dir %(installroot)/$vsdir
    cp -R %(workdir)/* %(installroot)/$vsdir/

    %install_exe %(pkgdir)/vscode.sh %(installroot)%(bindir)/code

    meta_info %(sourcedir)/code.desktop \
        | %install_file /dev/stdin "%(installroot)/usr/share/applications/code.desktop"
    meta_info %(sourcedir)/code-url-handler.desktop \
        | %install_file /dev/stdin "%(installroot)/usr/share/applications/code-url-handler.desktop"
    meta_info %(sourcedir)/code-workspace.xml \
        | %install_file /dev/stdin "%(installroot)/usr/share/mime/packages/code-workspace.xml"

    %install_file %(pkgdir)/vscode.svg %(installroot)/usr/share/icons/hicolor/scalable/apps/visual-studio-code.svg

    %install_dir %(installroot)%(bashcompletionsdir) %(installroot)%(zshcompletionsdir)
    ln -srv %(installroot)${vsdir}/resources/completions/bash/code %(installroot)%(bashcompletionsdir)/code
    ln -srv %(installroot)${vsdir}/resources/completions/zsh/_code %(installroot)%(zshcompletionsdir)/_code
