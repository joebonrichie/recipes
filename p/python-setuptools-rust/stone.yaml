#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : python-setuptools-rust
version     : 1.12.0
release     : 4
homepage    : https://github.com/Lucretiel/autocommand
upstreams   :
    - https://pypi.debian.net/setuptools-rust/setuptools_rust-1.12.0.tar.gz : d94a93f0c97751c17014565f07bdc324bee45d396cd1bba83d8e7af92b945f0c
summary     : Compile and distribute Python extensions written in rust as easily as if they were written in C
description : |
    Compile and distribute Python extensions written in rust as easily as if they were written in C
license     : MIT
networking  : true # tests
builddeps   :
    - python(setuptools)
    - python(setuptools-scm)
rundeps     :
    - binary(rustc)
    - python-libs
checkdeps   :
    - binary(pytest)
    - binary(rustc)
    - pkgconfig(python3)
    - python(cffi)
    - python(semantic-version)
build       : |
    %pyproject_build
install     : |
    %pyproject_install
check       : |
    # TODO: Enable the pytest tests which require at least beautifulsoup
    python_version=$(python -c 'import sys; print(".".join(map(str, sys.version_info[:2])))')
    for _dir in examples/*; do
        pushd $_dir
        PYTHONPATH="$PWD/../.." python -m build -nw
        python -m installer -d tmp_install dist/*.whl
        # [[ -d tests || -d test ]] && PYTHONPATH="$PWD/tmp_install/usr/lib/python$python_version/site-packages" pytest tests
        popd
    done
    # Need beautifulsoup for doctest
    # pytest --doctest-modules setuptools_rust
