#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : python-setuptools
version     : 80.9.0
release     : 9
homepage    : https://setuptools.pypa.io/
upstreams   :
    - https://pypi.debian.net/setuptools/setuptools-80.9.0.tar.gz:
        hash: f36b47402ecde768dbfafc46e8e4207b4360c654f1f3bb84475f0a28628fb19c
        unpackdir: setuptools

    # # Comment both of these out if not bootstrapping
    # - git|https://gitlab.archlinux.org/archlinux/python-bootstrap.git:
    #     ref: aff0f1a48c377c419f49b61babd6af78322e86f1
    # # Bootstrapping seemingly requires git source for setuptools (?)
    # - git|https://github.com/pypa/setuptools.git:
    #     ref: 9c4d383631d3951fcae0afd73b5d08ff5a262976 # Should correspond to the tag of the setuptools version
summary     : Easily download, build, install, upgrade, and uninstall Python packages
description : |
    Setuptools allows the easy download, build, install, upgrade, and uninstallation of Python packages.
license     : MIT
builddeps   :
    - binary(python)
    - python(jaraco-functools)
    - python(jaraco-text)
rundeps     :
    - binary(python3)
environment : |
    # set to 1 if bootstrapping against a new python
    _bootstrap=0

    # Don't want .exe files
    export SETUPTOOLS_INSTALL_WINDOWS_SPECIFIC_FILES=0

    if [[ ${_bootstrap} == "1" ]]; then
        cd ../python-bootstrap.git
    fi
setup       : |
    if [[ ${_bootstrap} == "1" ]]; then
        rm -rf external/setuptools

        ln -srv %(workdir)/../setuptools.git external/setuptools
    else
        rm -r setuptools/_vendor

        # Populate dependencies list for devendored deps
        sed '/^core =/,/]/!d' pyproject.toml > ../requirements.txt
        sed -i '1d;$d' ../requirements.txt
        sed -i '/^dependencies =/ {
            r ../requirements.txt
            s/^core =/dependencies =/
            }' pyproject.toml
    fi
build       : |
    if [[ ${_bootstrap} == "1" ]]; then
        python -m bootstrap.build
    else
        echo "Something to prevent bash syntax errors due to an empty if block"
        %pyproject_build
    fi
install     : |
    if [[ ${_bootstrap} == "1" ]]; then
        python -m bootstrap.install dist/setuptools-*-py3-none-any.whl -d "%(installroot)"
    else
        %pyproject_install

        # Delete vendored packages
        # TODO replace with python_version macro
        rm -rfv %(installroot)/%(libdir)/python3.*/site-packages/setuptools/_vendor/

        # Install wheel for virtualenv
        %install_file dist/*.whl -t %(installroot)%(datadir)/python-wheels
    fi

    # Undesired files
    find %(installroot) -type f -name "*.exe" -print -delete
packages    :
    - "%(name)-wheel":
        paths:
            - /usr/share/python-wheels
