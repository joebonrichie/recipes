#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : pipewire
version     : 1.4.9
release     : 22
homepage    : https://pipewire.org/
upstreams   :
    - https://gitlab.freedesktop.org/pipewire/pipewire/-/archive/1.4.9/pipewire-1.4.9.tar.gz : 8066a7b220069e4c6e3b02bd2b6ea303bba66df255023c07c99323449ba8fe3c
summary     : Linux audio + video multiplexing
description : |
    PipeWire is a project that aims to greatly improve handling of audio and video under Linux. It provides a low-latency, graph-based processing engine on top of audio and video devices that can be used to support the use cases currently handled by both PulseAudio and JACK. PipeWire was designed with a powerful security model that makes interacting with audio and video devices from containerized applications easy, with support for Flatpak applications being the primary goal.
license     :
    - MIT
builddeps   :
    - binary(doxygen)
    - binary(gettext)
    - cmake(VulkanHeaders)
    - pkgconfig(alsa)
    - pkgconfig(avahi-client)
    - pkgconfig(bluez)
    - pkgconfig(dbus-1)
    - pkgconfig(fdk-aac)
    - pkgconfig(fftw3f)
    - pkgconfig(gio-2.0)
    - pkgconfig(glib-2.0)
    - pkgconfig(gstreamer-1.0)
    - pkgconfig(gstreamer-video-1.0)
    - pkgconfig(lc3)
    - pkgconfig(ldacBT-enc)
    - pkgconfig(libavcodec)
    - pkgconfig(libavformat)
    - pkgconfig(libcanberra)
    - pkgconfig(libcap)
    - pkgconfig(libdrm)
    - pkgconfig(libebur128)
    - pkgconfig(libfreeaptx)
    - pkgconfig(libpulse)
    - pkgconfig(libswscale)
    - pkgconfig(libsystemd)
    - pkgconfig(libusb-1.0)
    - pkgconfig(lilv-0)
    - pkgconfig(ncursesw)
    - pkgconfig(openssl)
    - pkgconfig(readline)
    - pkgconfig(sndfile)
    - pkgconfig(systemd)
    - pkgconfig(vulkan)
    - pkgconfig(x11-xcb)
    - pkgconfig(xfixes)
    - pkgconfig(opus)
    - pkgconfig(sbc)
    - pkgconfig(sdl2-compat)
    - pkgconfig(webrtc-audio-processing-2)
    # libffado?
setup       : |
    %patch %(pkgdir)/0001-Fix-clang-build-error.patch

    %meson \
        -Dbluez5=enabled \
        -Dffmpeg=enabled \
        -Dgstreamer=enabled \
        -Dman=enabled \
        -Dsession-managers=[] \
        -Dudev=enabled \
        -Dudevrulesdir=%(libdir)/udev/rules.d \
        -Dvulkan=enabled
build       : |
    %meson_build
install     : |
    %meson_install
packages    :
    - "%(name)-libs":
        summary: "Library files for %(name)"
        description: |
            Library files for %(name), typically pulled in as a dependency of another package.
        paths:
            - /usr/lib/libpipewire-0.3.so.*
            - /usr/lib/spa-0.2/libspa.so

    # Hack for moss not handling this migration correctly
    - "%(name)":
        rundeps:
            - "%(name)-libs"
            - rtkit

    - "gstreamer-plugin-pipewire":
        summary: GStreamer pipewire plugin
        description: GStreamer pipewire plugin
        paths:
            - /usr/lib/gstreamer-1.0/
