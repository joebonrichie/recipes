#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : poppler
version     : 25.12.0
release     : 16
homepage    : https://poppler.freedesktop.org
upstreams   :
    - https://poppler.freedesktop.org/poppler-25.12.0.tar.xz : c18b40eb36b1a0c5b86e29ca054bf0770304583da4f2cdd42fe86eca6a20de48
    - git|https://gitlab.freedesktop.org/poppler/test.git : 9d5011815a14c157ba25bb160187842fb81579a5
summary     : A PDF rendering library
description : |
    Poppler is a PDF rendering library based on the xpdf-3.0 code base
license     : GPL-2.0-or-later
builddeps   :
    - binary(msgfmt)
    - binary(python3)
    - cmake(Boost)
    - cmake(Gpgmepp)
    - cmake(OpenJPEG)
    - cmake(Qt6)
    - pkgconfig(freetype2)
    - pkgconfig(gdk-pixbuf-2.0)
    - pkgconfig(gobject-introspection-1.0)
    - pkgconfig(gtk+-3.0)
    - pkgconfig(gpgme)
    - pkgconfig(lcms2)
    - pkgconfig(libcurl)
    - pkgconfig(libtiff-4)
    - pkgconfig(nss)
    - pkgconfig(zlib)
    - poppler-data
rundeps     :
    - poppler-data

    # Needs some dingbats compatible font
    # - https://en.wikipedia.org/wiki/PDF#Text
    # - https://mail.kde.org/pipermail/distributions/2025-December/001657.html
    - urw-base35-fonts
setup       : |
    %cmake \
      -DENABLE_QT5=OFF \
      -DTESTDATADIR=%(workdir)/../test.git \
      -DENABLE_UNSTABLE_API_ABI_HEADERS=ON
build       : |
    %cmake_build
install     : |
    %cmake_install
check       : |
    # These tests have been failing since https://gitlab.freedesktop.org/poppler/poppler/-/commit/2df6cf6e5c5dccecefc4b6f1dfba8c65c3aa94b0
    # for an unknown reason. Are we perhaps not initializing a database or something?
    %cmake_test \
        --exclude-regex 'signature/valid/.*|signature/invalid/.*|signature/digest_mismatch/.*'
workload    : |
    %cmake_test \
        --exclude-regex 'signature/valid/.*|signature/invalid/.*|signature/digest_mismatch/.*'
packages    :
    - "%(name)-glib":
        summary: A PDF rendering library - glib bindings
        description: Poppler is a PDF rendering library based on the xpdf-3.0 code base - glib bindings
        paths:
            - /usr/lib/libpoppler-glib.so.*
            - /usr/lib/girepository-1.0/Poppler*.typelib

    - "%(name)-glib-devel":
        summary: Development files for %(name)-glib
        description: Development files for %(name)-glib
        rundeps:
            - "%(name)-glib"
        paths:
            - /usr/include/poppler/glib
            - /usr/lib/libpoppler-glib.so
            - /usr/share/gir-1.0/Poppler*.gir
            - /usr/lib/pkgconfig/poppler-glib.pc

    - "%(name)-cpp":
        summary: Pure C++ wrapper for poppler
        description: Pure C++ wrapper for poppler
        paths:
            - /usr/lib/libpoppler-cpp.so.*

    - "%(name)-cpp-devel":
        summary: Development files for %(name)-cpp
        description: Development files for %(name)-cpp
        rundeps:
            - "%(name)-cpp"
        paths:
            - /usr/include/poppler/cpp
            - /usr/lib/libpoppler-cpp.so
            - /usr/lib/pkgconfig/poppler-cpp.pc

    - "%(name)-qt6":
        summary: A PDF rendering library - Qt6 bindings
        description: Poppler is a PDF rendering library based on the xpdf-3.0 code base - Qt6 bindings
        paths:
            - /usr/lib/libpoppler-qt6.so.*

    - "%(name)-qt6-devel":
        summary: Development files for %(name)-qt6
        description: Development files for %(name)-qt6
        paths:
            - /usr/include/poppler/qt6
            - /usr/lib/libpoppler-qt6.so
            - /usr/lib/pkgconfig/poppler-qt6.pc
        rundeps:
            - "%(name)-qt6"
            - "%(name)-devel"

    - "%(name)-utils":
        summary: A PDF rendering library - glib bindings
        description: Poppler is a PDF rendering library based on the xpdf-3.0 code base - glib bindings
        paths:
            - /usr/bin/pdf*
            - /usr/share/man/man1/
