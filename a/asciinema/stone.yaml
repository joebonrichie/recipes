#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : asciinema
version     : "3.0.0"
release     : 5
homepage    : https://asciinema.org/
upstreams   :
    - https://github.com/asciinema/asciinema/archive/refs/tags/v3.0.0.tar.gz : f44feaa1bc150e7964635dc4714fd86089a968587fed81dccf860ee7b64617ca
summary     : Terminal session recorder
description : |
    asciinema (aka asciinema CLI or asciinema recorder) is a command-line tool for recording terminal sessions.
license     : GPL-3.0
networking  : true
setup       : |
    %cargo_fetch
build       : |
    # ASCIINEMA_GEN_DIR defines where the build should generate man/completions
    ASCIINEMA_GEN_DIR="$PWD" \
        %cargo_build
install     : |
    %cargo_install

    # Man pages
    %install_file man/*.1 -t %(installroot)%(mandir)/man1/

    # Completions
    %install_file completion/asciinema.bash %(installroot)%(bashcompletionsdir)/asciinema
    %install_file completion/_asciinema -t %(installroot)%(zshcompletionsdir)
    %install_file completion/asciinema.fish -t %(installroot)%(fishcompletionsdir)
check       : |
    skipped=(
        pty::tests::spawn_basic # PTY interaction
    )
    %cargo_test -- ${skipped[@]/#/--skip } || :
