#
# SPDX-FileCopyrightText: © 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : networkmanager
version     : 1.54.1
release     : 10
homepage    : https://wiki.gnome.org/Projects/NetworkManager
upstreams   :
    - https://gitlab.freedesktop.org/NetworkManager/NetworkManager/-/releases/1.54.1/downloads/NetworkManager-1.54.1.tar.xz : 00f3f0be12ac4d4858ebf152430b92def1574803ff6107f7efc764a056d4c4c7
summary     : NetworkManager — network management daemon
description : |
    NetworkManager attempts to keep an active network connection available at all times.  The point of NetworkManager is to make networking configuration and setup as painless and automatic as possible.  NetworkManager is intended to replace default route, replace other routes, set IP addresses, and in general configure networking as NM sees fit (with the possibility of manual override as necessary).  In effect, the goal of NetworkManager is to make networking Just Work with a minimum of user hassle, but still allow customization and a high level of manual network control.  If you have special needs, we'd like to hear about them, but understand that NetworkManager is not intended for every use-case.
license     :
    - GFDL-1.1-or-later
    - GPL-2.0-or-later
    - LGPL-2.1-or-later
builddeps   :
    - binary(eu-readelf)
    - binary(gtkdoc-scan)
    - binary(msgfmt)
    - binary(perl)
    - binary(vapigen)
    - binary(xsltproc)
    - pkgconfig(bluez)
    - pkgconfig(dbus-1)
    - pkgconfig(gio-unix-2.0)
    - pkgconfig(gmodule-2.0)
    - pkgconfig(gnutls)
    - pkgconfig(gobject-introspection-1.0)
    - pkgconfig(jansson)
    - pkgconfig(libnewt)
    - pkgconfig(libcurl)
    - pkgconfig(libndp)
    - pkgconfig(libnvme)
    - pkgconfig(libpsl)
    - pkgconfig(libsystemd)
    - pkgconfig(libudev)
    - pkgconfig(mm-glib)
    - pkgconfig(mobile-broadband-provider-info)
    - pkgconfig(nss)
    - pkgconfig(polkit-gobject-1)
    - pkgconfig(readline)
    - pkgconfig(systemd)
    - pkgconfig(uuid)
    - python(pygobject) # Docs
    - docbook
    - docbook-xsl
    - ppp-devel
    # libaudit
tuning      :
    - lto: false # Handled by meson flag
environment : |
    %export_docbook_catalogs
setup       : |
    # TODO:
    # - Setup online check

    %meson \
        -Db_lto=true \
        -Dbluez5_dun=true \
        -Dconfig_dhcp_default=internal \
        -Dconfig_dns_rc_manager_default=auto \
        -Dconfig_logging_backend_default=journal \
        -Dconfig_plugins_default=keyfile \
        -Dconfig_wifi_backend_default=iwd \
        -Ddhcpcd=no \
        -Ddocs=true \
        -Diptables=%(sbindir)/iptables \
        -Dip6tables=%(sbindir)/ip6tables \
        -Diwd=true \
        -Dlibaudit=no \
        -Dmodify_system=true \
        -Dnft=%(sbindir)/nft \
        -Dnmtui=true \
        -Dpppd_plugin_dir="$(pkgconf --variable=plugindir pppd)" \
        -Dqt=false \
        -Dresolvconf=no \
        -Dselinux=false \
        -Dvapi=true
build       : |
    %meson_build
install     : |
    %meson_install

    %install_file %(pkgdir)/NetworkManager.tmpfiles %(installroot)%(tmpfilesdir)/%(name).conf
packages    :
    - "%(name)-libnm":
        paths:
            - /usr/lib/libnm.so.*
            - /usr/lib/girepository-1.0/NM-1.0.typelib

    - "%(name)-libnm-devel":
        rundeps:
            - "%(name)-libnm"
        paths:
            - /usr/include/libnm/
            - /usr/lib/pkgconfig/libnm.pc
            - /usr/lib/libnm.so
            - /usr/share/dbus-1/interfaces/
            - /usr/share/gir-1.0/NM-1.0.gir
            - /usr/share/vala/vapi/libnm.*

    - "%(name)-cloud-setup":
        summary: Automatically configure NetworkManager in cloud
        description: Automatically configure NetworkManager in cloud
        rundeps:
            - "%(name)"
        paths:
            - /usr/lib/networkmanager/nm-cloud-setup
            - /usr/lib/systemd/system/nm-cloud-setup.*
            - /usr/lib/NetworkManager/dispatcher.d/**/90-nm-cloud-setup.sh
            - /usr/share/man/man8/nm-cloud-setup.*

    - "%(name)-tui":
        summary: NetworkManager curses-based UI
        description: NetworkManager curses-based UI
        paths:
            - /usr/bin/nmtui*
            - /usr/share/man/man1/nmtui*

    - "%(name)-adsl":
        summary: ADSL device plugin for NetworkManager
        description: ADSL device plugin for NetworkManager
        rundeps:
            - "%(name)"
        paths:
            - /usr/lib/NetworkManager/*/libnm-device-plugin-adsl.so

    - "%(name)-bluetooth":
        summary: Bluetooth device plugin for NetworkManager
        description: Bluetooth device plugin for NetworkManager
        rundeps:
            - "%(name)"
            - "%(name)-wwan"
            - bluez
        paths:
            - /usr/lib/NetworkManager/*/libnm-device-plugin-bluetooth.so

    - "%(name)-wifi":
        summary: Wifi device plugin for NetworkManager
        description: Wifi device plugin for NetworkManager
        rundeps:
            - "%(name)"
            - binary(iwmon)
            - sysbinary(set-wireless-regdom)
        paths:
            - /usr/lib/NetworkManager/*/libnm-device-plugin-wifi.so

    - "%(name)-wwan":
        summary: Mobile broadband device plugin for NetworkManager
        description: Mobile broadband device plugin for NetworkManager
        rundeps:
            - "%(name)"
            - binary(mmcli)
        paths:
            - /usr/lib/NetworkManager/*/libnm-device-plugin-wwan.so
            - /usr/lib/NetworkManager/*/libnm-wwan.so

    - "%(name)-ovs":
        summary: Open vSwitch device plugin for NetworkManager
        description: Open vSwitch device plugin for NetworkManager
        rundeps:
            - "%(name)"
        paths:
            - /usr/lib/NetworkManager/*/libnm-device-plugin-ovs.so

    - "%(name)-ppp":
        summary: PPP device plugin for NetworkManager
        description: PPP device plugin for NetworkManager
        rundeps:
            - "%(name)"
            - ppp
        paths:
            - /usr/lib/NetworkManager/*/libnm-ppp-plugin.so
            - /usr/lib/pppd/*/nm-pppd-plugin.so
