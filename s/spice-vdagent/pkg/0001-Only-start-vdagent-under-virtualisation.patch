From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Thomas Staudinger <Staudi.Kaos@gmail.com>
Date: Fri, 18 Mar 2022 19:40:38 +0100
Subject: [PATCH] Only start vdagent under virtualisation

---
 data/spice-vdagent.service  | 2 ++
 data/spice-vdagentd.service | 2 ++
 2 files changed, 4 insertions(+)

diff --git a/data/spice-vdagent.service b/data/spice-vdagent.service
index 7f01a45..406b38c 100644
--- a/data/spice-vdagent.service
+++ b/data/spice-vdagent.service
@@ -1,6 +1,8 @@
 [Unit]
 Description=Spice guest session agent
 Documentation=man:spice-vdagent(1)
+# Only start in a VM
+ConditionVirtualization=vm
 
 # Only run whenever the system daemon is running, since this
 # service isn't useful on its own
diff --git a/data/spice-vdagentd.service b/data/spice-vdagentd.service
index 07d42ae..8903fbd 100644
--- a/data/spice-vdagentd.service
+++ b/data/spice-vdagentd.service
@@ -1,6 +1,8 @@
 [Unit]
 Description=Agent daemon for Spice guests
 Documentation=man:spice-vdagentd(1)
+# Only start in a VM
+ConditionVirtualization=vm
 Requires=spice-vdagentd.socket systemd-logind.service
 After=systemd-logind.service
 
