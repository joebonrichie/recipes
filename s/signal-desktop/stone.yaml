#
# SPDX-FileCopyrightText: Â© 2025- AerynOS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : signal-desktop
version     : 7.86.0
release     : 4
homepage    : https://signal.org
upstreams   :
    - git|https://github.com/signalapp/Signal-Desktop.git : 567ad4da77b763cb8e17076035b823740bac6a39
summary     : A private messenger for Windows, macOS, and Linux
description : |
    Signal Desktop links with Signal on Android or iOS and lets you message from your Windows, macOS, and Linux computers.
license     : AGPL-3.0-or-later
builddeps  :
    - binary(ar)
    - binary(bsdtar-static)
    - binary(pnpm)
    - binary(tar)
    - pkgconfig(alsa)
    - pkgconfig(cups)
    - pkgconfig(gbm)
    - pkgconfig(gtk+-3.0)
    - pkgconfig(libdrm)
    - pkgconfig(libpulse)
    - pkgconfig(xscrnsaver)
    - soname(libcrypt.so.1(x86_64))
debug       : false
strip       : false
networking  : true
setup      : |
    pnpm install
build      : |
    pnpm run generate
    pnpm run build:release
install     : |
    _signal_root=%(libdir)/signal
    _signal_install=%(installroot)/$_signal_root

    %install_dir $_signal_install
    cp -R release/linux-unpacked/* $_signal_install

    %install_dir %(installroot)%(bindir)
    ln -svf $_signal_root/signal-desktop %(installroot)%(bindir)/signal-desktop

    # Desktop file, icon
    %install_file %(pkgdir)/signal-desktop.desktop %(installroot)/%(datadir)/applications/signal-desktop.desktop

    for i in 16 32 48 64 128 256 512 1024; do
        %install_file build/icons/png/${i}x${i}.png %(installroot)%(datadir)/icons/hicolor/${i}x${i}/apps/signal-desktop.png
    done
