#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : cryptsetup
version     : 2.8.3
release     : 10
homepage    : https://gitlab.com/cryptsetup/cryptsetup
upstreams   :
    - https://gitlab.com/cryptsetup/cryptsetup/-/archive/v2.8.3/cryptsetup-v2.8.3.tar.gz : 2d84344876a8229a058d59a3b273368084c3899095a49494ee7294c5885c2cb9
summary     : cryptsetup + LUKS
description : |
    cryptsetup + LUKS - open source disk encryption
license     :
    - CC0-1.0
    - GPL-2.0-or-later
    - LGPL-2.1-or-later
builddeps   :
    - binary(asciidoctor)
    - binary(gettext)
    - pkgconfig(blkid)
    - pkgconfig(devmapper)
    - pkgconfig(json-c)
    - pkgconfig(libcrypto)
    - pkgconfig(libgcrypt)
    - pkgconfig(libssh)
    - pkgconfig(nettle)
    - pkgconfig(popt)
    - pkgconfig(pwquality)
    - pkgconfig(systemd)
    - pkgconfig(uuid)
setup       : |
    %patch %(pkgdir)/0001-meson-Install-binaries.patch
    %patch %(pkgdir)/0001-Fix-lockdir-perms.patch

    %meson \
        -Dargon-implementation=internal \
        -Dinternal-sse-argon2=true \
        -Dssh-token=true
build       : |
    %meson_build
install     : |
    %meson_install
packages    :
    - "%(name)-libs":
        summary: "Library files for %(name)"
        description: |
            Library files for %(name), typically pulled in as a dependency of another package.
        paths:
            - /usr/lib/libcryptsetup.so.*
            - /usr/lib/tmpfiles.d/cryptsetup.conf
            - /usr/share/locale/

    - "%(name)-ssh-token":
        summary: Cryptsetup LUKS2 SSH token
        description: |
            This package contains the LUKS2 SSH token.
        paths:
            - /usr/sbin/cryptsetup-ssh
            - /usr/lib/cryptsetup/libcryptsetup-token-ssh.so
            - /usr/share/man/man8/cryptsetup-ssh.8*

    - "integritysetup":
        summary: A utility for setting up dm-integrity volumes
        description: |
            The integritysetup package contains a utility for setting up
            disk integrity protection using dm-integrity kernel module.
        paths:
            - /usr/sbin/integritysetup
            - /usr/share/man/man8/integritysetup.8*

    - "veritysetup":
        summary: A utility for setting up dm-verity volumes
        description: |
            The veritysetup package contains a utility for setting up
            disk verification using dm-verity kernel module.
        paths:
            - /usr/sbin/veritysetup
            - /usr/share/man/man8/veritysetup.8*
