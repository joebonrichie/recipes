#
# SPDX-FileCopyrightText: Â© 2020-2025 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : kmscon
version     : 9.3.0
release     : 3
upstreams   :
    - https://github.com/kmscon/kmscon/archive/refs/tags/v9.3.0.tar.gz : 72d968a3b057c8b178381c84cb8584b3b5e75c4133cd9728fa3647690b9b146b
homepage    : https://www.freedesktop.org/wiki/Software/kmscon
license     :
    - MIT
    - LGPL-2.1-or-later # external/htable.* external/dbus-loop.*
summary     : KMS/DRM based virtual Console Emulator
description : |
    kmscon is a system console for linux. It does not depend on any graphics-server on your system (like X.org), but instead provides a raw console layer that can be used independently. It can replace the linux kernel console entirely but was designed to work well side-by-side, too. Even though initially targeted at providing internationalization to the system-console, it has grown into a fully modularized console layer including features like multi-head support, internationalized font rendering, XKB-compatible keyboard handling, hardware-accelerated graphics access and more.
builddeps   :
    - binary(xsltproc)
    - pkgconfig(egl)
    - pkgconfig(gbm)
    - pkgconfig(glesv2)
    - pkgconfig(libdrm)
    - pkgconfig(libtsm)
    - pkgconfig(pangoft2)
    - pkgconfig(systemd)
    - pkgconfig(xkbcommon)
checkdeps   :
    - pkgconfig(check)
setup       : |
    %meson
build       : |
    %meson_build
install     : |
    %meson_install

    %install_file %(pkgdir)/kmscon.preset %(installroot)%(libdir)/systemd/system-preset/kmscon.preset

    # Make it the default
    # - we need to undo this until the issue with kmscon hogging the display
    #   despite a display manager being active is fixed. Upstream is aware.
    #ln -sv kmsconvt@.service %(installroot)%(libdir)/systemd/system/autovt@.service
check       : |
    %meson_test
packages    :
    - "%(name)-gl":
        summary: Adds OpenGL/DRM support to kmscon
        description: Adds OpenGL/DRM support to kmscon
        rundeps:
            - "%(name)"
        paths:
            - /usr/lib/kmscon/mod-drm3d.so
            - /usr/lib/kmscon/mod-gltex.so
