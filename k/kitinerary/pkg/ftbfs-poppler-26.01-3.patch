From fae4b523d7d2f3216789886ec3d1dc43b981b683 Mon Sep 17 00:00:00 2001
From: Volker Krause <vkrause@kde.org>
Date: Fri, 2 Jan 2026 18:11:32 +0100
Subject: [PATCH] Adapt extractor scripts to Poppler 26.01 whitespace changes

---
 src/lib/scripts/airasia.js                  |  2 +-
 src/lib/scripts/amtrack.js                  |  2 +-
 src/lib/scripts/ana.js                      |  2 +-
 src/lib/scripts/arriva.js                   |  2 +-
 src/lib/scripts/atlatos.js                  |  4 ++-
 src/lib/scripts/bremer-baeder.js            |  2 +-
 src/lib/scripts/brusselsairlines-receipt.js |  4 +--
 src/lib/scripts/centerparc.js               |  2 +-
 src/lib/scripts/cooltix.js                  |  2 +-
 src/lib/scripts/dav.js                      |  2 +-
 src/lib/scripts/dsb.js                      |  2 +-
 src/lib/scripts/easyjet.js                  | 27 ++++++++++-----------
 src/lib/scripts/eckeroline.js               |  2 +-
 src/lib/scripts/egencia.js                  |  2 +-
 src/lib/scripts/ethiad.js                   |  2 +-
 src/lib/scripts/eurostar.js                 |  2 +-
 src/lib/scripts/eventim.js                  |  2 +-
 src/lib/scripts/eventyay.js                 |  2 +-
 src/lib/scripts/flixbus.js                  |  4 +--
 src/lib/scripts/globtour.js                 |  5 ++--
 src/lib/scripts/grimaldi-lines.js           |  2 +-
 src/lib/scripts/iberia.js                   | 12 ++++-----
 src/lib/scripts/ltg-link.js                 |  2 +-
 src/lib/scripts/lufthansa.js                |  4 +--
 src/lib/scripts/nationalrail.js             |  2 +-
 src/lib/scripts/ouigo-es.js                 |  6 ++---
 src/lib/scripts/pasazieru-vilciens.js       |  4 +--
 src/lib/scripts/pretix.js                   |  6 ++---
 src/lib/scripts/sas-boardingpass.js         |  2 +-
 src/lib/scripts/sas-receipt.js              |  2 +-
 src/lib/scripts/scandlines.js               |  2 --
 src/lib/scripts/sncf.js                     |  6 ++---
 src/lib/scripts/tcdd.js                     |  4 +--
 src/lib/scripts/thalys.js                   |  2 +-
 src/lib/scripts/ticketmaster.js             |  4 +--
 src/lib/scripts/tito.js                     |  6 ++---
 src/lib/scripts/tobilet.js                  |  3 +--
 src/lib/scripts/trenitalia.js               |  3 +--
 src/lib/scripts/viarail.js                  |  3 +--
 src/lib/scripts/vistara.js                  |  6 ++---
 src/lib/scripts/vr.fi.js                    |  2 +-
 41 files changed, 76 insertions(+), 81 deletions(-)

diff --git a/src/lib/scripts/airasia.js b/src/lib/scripts/airasia.js
index 63b876ae7..013d08023 100644
--- a/src/lib/scripts/airasia.js
+++ b/src/lib/scripts/airasia.js
@@ -39,7 +39,7 @@ function extractItinerary(pdf) {
     let reservations = [];
     let idx = 0;
     while (true) {
-        const leg = text.substr(idx).match(/(\d\d:\d\d) +(\S.*)\n *(\d\d \S{3}) +(\S.*)\n +(\S.*\S) *, *([A-Z0-9]{2}) (\d{1,4})\n.*\n.*\n *(\d\d:\d\d) +(\S.*)\n *(\d\d \S{3}) +(\S.*)\n/);
+        const leg = text.substr(idx).match(/(\d\d:\d\d) +(\S.*)\n *(\d\d \S{3}) +(\S.*)\n+ +(\S.*\S) *, *([A-Z0-9]{2}) (\d{1,4})\n.*\n.*\n+ *(\d\d:\d\d) +(\S.*)\n *(\d\d \S{3}) +(\S.*)\n/);
         if (!leg)
             break;
         idx += leg.index + leg[0].length;
diff --git a/src/lib/scripts/amtrack.js b/src/lib/scripts/amtrack.js
index 45607bf88..25d4311b4 100644
--- a/src/lib/scripts/amtrack.js
+++ b/src/lib/scripts/amtrack.js
@@ -31,7 +31,7 @@ function parseTicket(pdf, node, triggerNode) {
         }
 
         // format variant 2
-        train = text.substr(idx).match(/TRAIN .* DEPARTS +ARRIVES\n *(\d+)  +([A-Z][a-z]{2} \d{1,2}, \d{4})  +(\d{1,2}:\d{2} [AP]M)  +(\d{1,2}:\d{2} [AP]M)\n  +(.*?)  +(.*)\n(?: +\w.*\n)? *\d+ (.*) Seat/);
+        train = text.substr(idx).match(/TRAIN .* DEPARTS +ARRIVES\n+ *(\d+)  +([A-Z][a-z]{2} \d{1,2}, \d{4})  +(\d{1,2}:\d{2} [AP]M)  +(\d{1,2}:\d{2} [AP]M)\n  +(.*?)  +(.*)\n+(?: +\w.*\n+)? *\d+ (.*) Seat/);
         if (train) {
             leg.reservationFor.trainNumber = train[1];
             leg.reservationFor.departureTime = JsonLd.toDateTime(train[2] + ' ' + train[3], 'MMM d, yyyy h:mm AP', 'en');
diff --git a/src/lib/scripts/ana.js b/src/lib/scripts/ana.js
index f551b22ef..3cba385e0 100644
--- a/src/lib/scripts/ana.js
+++ b/src/lib/scripts/ana.js
@@ -10,7 +10,7 @@ function extractPdfEticket(pdf, node, barcode) {
     let reservations = [];
     let idx = 0;
     while (true) {
-        const leg = text.substr(idx).match(/\] (\S.*?\S) (?: +(\S+)  )? +([A-Z-0-9]{2})(\d{1,4}) +(\d{2}[A-Z]{3}\d{2}) +[A-Z]{3} +(\d{4}).*\n.*\n *(\S.*?\S) (?: +(\S+)  )? +(\d{2}[A-K])? +(\d{2}[A-Z]{3}\d{2}) +[A-Z]{3} +(\d{4}) *(\S.*\S)/);
+        const leg = text.substr(idx).match(/\] (\S.*?\S) (?: +(\S+)  )? +([A-Z-0-9]{2})(\d{1,4}) +(\d{2}[A-Z]{3}\d{2}) +[A-Z]{3} +(\d{4}).*\n.*\n+ *(\S.*?\S) (?: +(\S+)  )? +(\d{2}[A-K])? +(\d{2}[A-Z]{3}\d{2}) +[A-Z]{3} +(\d{4}) *(\S.*\S)/);
         if (!leg)
             break;
         idx += leg.index + leg[0].length;
diff --git a/src/lib/scripts/arriva.js b/src/lib/scripts/arriva.js
index 72c081ef3..9c9774488 100644
--- a/src/lib/scripts/arriva.js
+++ b/src/lib/scripts/arriva.js
@@ -4,7 +4,7 @@
 function extractTicket(pdf, node, barcode) {
     const text = pdf.pages[barcode.location].text;
     let res = JsonLd.newBusReservation();
-    const trip = text.match(/(\S.*\S)  +(\d{11}-\d)\n.*\n *(\S.*\S)  +(\d+)\n.*\n *(\S.*\S)  +\d.*\n *(\S.*\S)\n.*\n *(\S.*\S)  +(\S.*?)  +(\S.*)\n.*\n *(\S.*?\S)  +/);
+    const trip = text.match(/(\S.*\S)  +(\d{11}-\d)\n+.*\n *(\S.*\S)  +(\d+)\n+.*\n *(\S.*\S)  +\d.*\n *(\S.*\S)\n+.*\n *(\S.*\S)  +(\S.*?)  +(\S.*)\n+.*\n *(\S.*?\S)  +/);
     res.underName.name = trip[1];
     res.reservedTicket.ticketNumber = trip[2];
     res.reservedTicket.name = trip[3];
diff --git a/src/lib/scripts/atlatos.js b/src/lib/scripts/atlatos.js
index 389a45398..8e8fbf8bd 100644
--- a/src/lib/scripts/atlatos.js
+++ b/src/lib/scripts/atlatos.js
@@ -30,12 +30,14 @@ function extractPdf(pdf)
     let text = "";
     for (const page of pdf.pages) {
         text += page.textInRect(0.0, 0.0, 1.0, 0.9);
+        if (!text.endsWith('\n'))
+            text += '\n';
     }
 
     let reservations = [];
     let idx = 0;
     while (true) {
-        const flight = text.substr(idx).match(/: +(\S.*\S) +([A-Z0-9]{2})\/([A-Z0-9]{6})\n.*: +(\S.*?), (\S.*(?:\n +.*)*)\n.*(\d\d[\d\.: ]{14}).*\n.* ([A-Z0-9]{2}) (\d{1,4}) .*\n.*\n.*: +(\S.*?), (\S.*(?:\n +.*)*)\n.*(\d\d[\d\.: ]{14}).*\n/);
+        const flight = text.substr(idx).match(/: +(\S.*\S) +([A-Z0-9]{2})\/([A-Z0-9]{6})\n.*: +(\S.*?), (\S.*(?:\n +.*)*)\n.*(\d\d[\d\.: ]{14}).*\n.* ([A-Z0-9]{2}) (\d{1,4}) .*\n+.*\n+.*: +(\S.*?), (\S.*(?:\n +.*)*)\n.*(\d\d[\d\.: ]{14}).*\n/);
         if (!flight) {
             break;
         }
diff --git a/src/lib/scripts/bremer-baeder.js b/src/lib/scripts/bremer-baeder.js
index 3d43a14eb..b703dd254 100644
--- a/src/lib/scripts/bremer-baeder.js
+++ b/src/lib/scripts/bremer-baeder.js
@@ -14,7 +14,7 @@ function parseTicket(pdf, node) {
     res.reservationNumber = text.match(/Auftrag (\d+)/)[1];
     res.underName.givenName = text.match(/Vorname: (.*?)\n/)[1];
     res.underName.familyName = text.match(/Name: (.*?)\n/)[1];
-    res.reservationFor.name = text.match(/ONLINE-TICKET\n *(.*?) -/)[1];
+    res.reservationFor.name = text.match(/ONLINE-TICKET\n+ *(.*?) -/)[1];
     res.reservationFor.location.address.addressCountry = "DE"; // to get the right timezone
     return res;
 }
diff --git a/src/lib/scripts/brusselsairlines-receipt.js b/src/lib/scripts/brusselsairlines-receipt.js
index c9ec4aff3..179fb720b 100644
--- a/src/lib/scripts/brusselsairlines-receipt.js
+++ b/src/lib/scripts/brusselsairlines-receipt.js
@@ -18,10 +18,10 @@ function extractColumn(page, offset) {
         }
     }
 
-    var dep = text.match(/Departure time.*\n(\d{1,2} \w+ \d{4})\s+(\d{1,2}:\d{2})/);
+    const dep = text.match(/Departure time.*\n+(\d{1,2} \w+ \d{4})\s+(\d{1,2}:\d{2})/);
     if (dep)
         res.reservationFor.departureTime = JsonLd.toDateTime(dep[1] + " " + dep[2], "dd MMMM yyyy hh:mm", "en");
-    var arr = text.match(/Arrival time.*\n(\d{1,2} \w+ \d{4})\s+(\d{1,2}:\d{2})/);
+    const arr = text.match(/Arrival time.*\n+(\d{1,2} \w+ \d{4})\s+(\d{1,2}:\d{2})/);
     if (arr)
         res.reservationFor.arrivalTime = JsonLd.toDateTime(arr[1] + " " + arr[2], "dd MMMM yyyy hh:mm", "en");
 
diff --git a/src/lib/scripts/centerparc.js b/src/lib/scripts/centerparc.js
index d959f8cbb..22a3c9aaf 100644
--- a/src/lib/scripts/centerparc.js
+++ b/src/lib/scripts/centerparc.js
@@ -4,7 +4,7 @@
 function extractPdf(pdf, node, barcode) {
     const text = pdf.pages[barcode.location].text;
     let res = JsonLd.newLodgingReservation();
-    const name = text.match(/(.*)\n.*: (.*)\n/);
+    const name = text.match(/(.*)\n+.*: (.*)\n/);
     res.reservationFor.name = name[2];
     res.underName.name = name[1];
     const dates = text.match(/(\d{2}\.\d{2}\.\d{4})\s+(\d{2}\.\d{2}\.\d{4})/);
diff --git a/src/lib/scripts/cooltix.js b/src/lib/scripts/cooltix.js
index 2df5f74c0..4a80049c5 100644
--- a/src/lib/scripts/cooltix.js
+++ b/src/lib/scripts/cooltix.js
@@ -16,7 +16,7 @@ function extractPdf(pdf, node) {
         }
         const page = pdf.pages[i];
         const leftCol = page.textInRect(0.0, 0.0, 0.33, 1.0);
-        const event = leftCol.match(/.*\n((?:.*\n)*.*)\n.*\n(.{3} \d\d, \d{4} \d{1,2}:\d\d ..)\n.*\n(.{3} \d\d, \d{4} \d{1,2}:\d\d ..)\n.*\n(.*)\n(.*)\n(.*)\n/);
+        const event = leftCol.match(/.*\n((?:.*\n)*.*)\n.*\n(.{3} \d\d, \d{4} \d{1,2}:\d\d ..)\n+.*\n(.{3} \d\d, \d{4} \d{1,2}:\d\d ..)\n+.*\n(.*)\n(.*)\n(.*)\n/);
         res.reservationFor.name = event[1].split('|')[0];
         res.reservationFor.startDate = JsonLd.toDateTime(event[2], 'MMM dd, yyyy h:mm A', 'en');
         res.reservationFor.endDate = JsonLd.toDateTime(event[3], 'MMM dd, yyyy h:mm A', 'en');
diff --git a/src/lib/scripts/dav.js b/src/lib/scripts/dav.js
index 31bd9c1f1..fdc81e833 100644
--- a/src/lib/scripts/dav.js
+++ b/src/lib/scripts/dav.js
@@ -4,7 +4,7 @@
 */
 
 function parseMembershipCard(pdf, node) {
-    const c = pdf.text.split('\n')
+    const c = pdf.text.split(/\n+/)
     const num = c[6].match(/\d{3}\/\d{2}\/(\d+)\*.*$/)[1]
     let card = {
         '@type': 'ProgramMembership',
diff --git a/src/lib/scripts/dsb.js b/src/lib/scripts/dsb.js
index fecbfcaf1..401eb6239 100644
--- a/src/lib/scripts/dsb.js
+++ b/src/lib/scripts/dsb.js
@@ -7,7 +7,7 @@ function extractReservation(pdf, node, barcode) {
         const page = pdf.pages[i].text;
         let idx = 0;
         while (true) {
-            const leg = page.substr(idx).match(/(\d\d\.\S{3}\.) +(\d\d:\d\d) +(\S.*\S)  +(\S.*\S)  +(\d\d\.\S{3}\.)  +(\d\d:\d\d)\n.*\n(\S.*?\S)  +(\d+)  +(\S.*?\S)  +\d  +(\S.*?\S)  +(\S.*\S)\n(\d+)?/)
+            const leg = page.substr(idx).match(/(\d\d\.\S{3}\.) +(\d\d:\d\d) +(\S.*\S)  +(\S.*\S)  +(\d\d\.\S{3}\.)  +(\d\d:\d\d)\n+.*\n+(\S.*?\S)  +(\d+)  +(\S.*?\S)  +\d  +(\S.*?\S)  +(\S.*\S)\n(\d+)?/)
             if (!leg)
                 break;
             idx += leg.index + leg[0].length;
diff --git a/src/lib/scripts/easyjet.js b/src/lib/scripts/easyjet.js
index ffdee7c63..b49fc9593 100644
--- a/src/lib/scripts/easyjet.js
+++ b/src/lib/scripts/easyjet.js
@@ -59,20 +59,19 @@ function parsePdfBoardingPass(pdf, node, triggerNode)
 {
     var res = triggerNode.result[0];
 
-    var page = pdf.pages[triggerNode.location];
-    var rightCol = page.textInRect(0.65, 0, 1, 0.25);
-    var depName = rightCol.match(/(?:from|Flying)\n\([A-Z]{3}\) ([^]*?)\n(?:to|Going)/);
-    if (depName)
-        res.reservationFor.departureAirport.name = depName[1];
-    var arrName = rightCol.match(/(?:to|Going)\n\([A-Z]{3}\) ([^]*?)\ndeparts/);
-    if (arrName)
-        res.reservationFor.arrivalAirport.name = arrName[1];
-    var depTime = rightCol.match(/(?:departs|Flight)\n(\d\d:\d\d)/);
-    if (depTime)
-        res.reservationFor.departureTime = JsonLd.toDateTime(depTime[1], "hh:mm", "en");
-
-    var leftCol = page.textInRect(0, 0, 0.3, 0.25);
-    var boarding = leftCol.match(/(?:closes|Gate)\n(\d\d:\d\d)/);
+    const page = pdf.pages[triggerNode.location];
+    const rightCol = page.textInRect(0.65, 0, 1, 0.25)
+        .replace(/(?:\n|  +)/g, ' ')
+        .replace(/(?:from Flying|to Going|departs Flight)/g, '')
+        .trim();
+
+    const airports = rightCol.match(/\([A-Z]{3}\) (.*) \([A-Z]{3}\) (.*) (\d\d:\d\d)/);
+    res.reservationFor.departureAirport.name = airports[1];
+    res.reservationFor.arrivalAirport.name = airports[2];
+    res.reservationFor.departureTime = JsonLd.toDateTime(airports[3], "HH:mm", "en");
+
+    const leftCol = page.textInRect(0, 0, 0.3, 0.25);
+    const boarding = leftCol.match(/(?:closes|Gate)\n+ *(\d\d:\d\d)/);
     if (boarding)
         res.reservationFor.boardingTime = JsonLd.toDateTime(boarding[1], "hh:mm", "en");
 
diff --git a/src/lib/scripts/eckeroline.js b/src/lib/scripts/eckeroline.js
index 8f2d69547..d4c7c11e9 100644
--- a/src/lib/scripts/eckeroline.js
+++ b/src/lib/scripts/eckeroline.js
@@ -3,7 +3,7 @@
 
 function extractPdf(pdf, node, barcode) {
     const page = pdf.pages[barcode.location].text;
-    const trip = page.match(/Boarding card\n(.*)\n(\d{2}\.\d{2}\.\d{4} \d{2}\.\d{2}) (.*) - (.*)\n(.*)\nBooking: (.*)\n/);
+    const trip = page.match(/Boarding card\n(.*)\n(\d{2}\.\d{2}\.\d{4} \d{2}\.\d{2}) (.*) - (.*)\n+(.*)\n+Booking: (.*)\n/);
 
     let res = JsonLd.newBoatReservation();
     res.reservedTicket.ticketToken = 'qrCode:' + barcode.content;
diff --git a/src/lib/scripts/egencia.js b/src/lib/scripts/egencia.js
index dc475033c..cdebecd89 100644
--- a/src/lib/scripts/egencia.js
+++ b/src/lib/scripts/egencia.js
@@ -41,7 +41,7 @@ function extractPdf(pdf) {
         let res = JsonLd.newLodgingReservation();
         res.reservationFor.name = hotel[1];
         res.reservationNumber = hotel[2];
-        const dates = text.substr(idx).match(/CHECK-IN +CHECK-OUT\n *(\d{1,2}[ -][a-z]{3}[ -]\d{4}) +(\d{1,2}[ -][a-z]{3}[ -]\d{4})\n.*\n([\s\S]+?,[ \n][A-Z]{3})\n/);
+        const dates = text.substr(idx).match(/CHECK-IN +CHECK-OUT\n+ *(\d{1,2}[ -][a-z]{3}[ -]\d{4}) +(\d{1,2}[ -][a-z]{3}[ -]\d{4})\n+.*\n+([\s\S]+?,[ \n][A-Z]{3})\n/);
         res.checkinTime = JsonLd.toDateTime(dates[1], ["d-MMM-yyyy", "d MMM yyyy"], ["en", "it"]);
         res.checkoutTime = JsonLd.toDateTime(dates[2], ["d-MMM-yyyy", "d MMM yyyy"], ["en", "it"]);
 
diff --git a/src/lib/scripts/ethiad.js b/src/lib/scripts/ethiad.js
index 03becf890..f9da8c208 100644
--- a/src/lib/scripts/ethiad.js
+++ b/src/lib/scripts/ethiad.js
@@ -12,7 +12,7 @@ function extractTicket(pdf, node) {
     baseRes.underName = node.result[0].underName;
 
     while (true) {
-        const leg = text.substr(idx).match(/(?:_([A-Z]{3})\n)? *(\d\d:\d\d) +(\d\d:\d\d)\n *([A-Z]{3})? +([A-Z]{3})\n *(\d\d \S{3} \d{4}) +.* +(\d\d \S{3} \d{4})\n *(\S.*)  +(\S.*)\n *(\S.*)  +(\S.*)\n *(\S.*)  +(\S.*)\n.*?([A-Z0-9]{2})(\d{1,4}).*: (\S.*)  /);
+        const leg = text.substr(idx).match(/(?:_([A-Z]{3})\n)? *(\d\d:\d\d) +(\d\d:\d\d)\n+ *([A-Z]{3})? +([A-Z]{3})\n *(\d\d \S{3} \d{4}) +.* +(\d\d \S{3} \d{4})\n *(\S.*)  +(\S.*)\n *(\S.*)  +(\S.*)\n *(\S.*)  +(\S.*)\n.*?([A-Z0-9]{2})(\d{1,4}).*: (\S.*)  /);
         if (!leg)
             break;
         idx += leg.index +leg[0].length;
diff --git a/src/lib/scripts/eurostar.js b/src/lib/scripts/eurostar.js
index b85658858..b1cdbc7cf 100644
--- a/src/lib/scripts/eurostar.js
+++ b/src/lib/scripts/eurostar.js
@@ -61,7 +61,7 @@ function parsePdfSSB(pdf, node, ssb) {
         res.reservationFor.arrivalTime = JsonLd.toDateTime(date[1] + ' ' + time[2], ["MMM d, yyyy hh:mm", "d MMMM yyyy hh:mm", "d. MMM. yyyy HH:mm", "d MMM. yyyy HH:mm"], ["en", "fr", "de"]);
         res.reservationFor.departureStation.name = dep;
         res.reservationFor.arrivalStation.name = arr;
-        const pas = text.match(/PNR\n *(\S.*\S)  +([A-Z0-9]{6})\n/);
+        const pas = text.match(/PNR\n+ *(\S.*\S)  +([A-Z0-9]{6})\n/);
         res.reservationNumber = pas[2];
         res.underName.name = pas[1];
         // pdf417 works just as well, but the vastly different format surprises people...
diff --git a/src/lib/scripts/eventim.js b/src/lib/scripts/eventim.js
index beefb25f4..b98397751 100644
--- a/src/lib/scripts/eventim.js
+++ b/src/lib/scripts/eventim.js
@@ -49,7 +49,7 @@ function parseTicketDirect(pdf, node, triggerNode)
 
     let res = JsonLd.newEventReservation();
     res.reservationNumber = text.match(/Ticket Nummer: (\d+-\d+)\n/)[1];
-    const dt = text.match(/([A-Z][a-z]+, \d{2}\.\d{2}\.\d{4}).*\n.*(\d{2}:\d{2}) Uhr(?:.*\n.*?(\d{2}:\d{2}) Uhr.*)?/);
+    const dt = text.match(/([A-Z][a-z]+, \d{2}\.\d{2}\.\d{4}).*\n+.*(\d{2}:\d{2}) Uhr(?:.*\n.*?(\d{2}:\d{2}) Uhr.*)?/);
 
     if (dt[3]) {
         res.reservationFor.doorTime = JsonLd.toDateTime(dt[1] + dt[2], 'dddd, dd.MM.yyyyhh:mm', 'de');
diff --git a/src/lib/scripts/eventyay.js b/src/lib/scripts/eventyay.js
index be35eafb3..2073ee93b 100644
--- a/src/lib/scripts/eventyay.js
+++ b/src/lib/scripts/eventyay.js
@@ -8,7 +8,7 @@ function extractTicket(pdf, node, barcode) {
     res.reservedTicket.ticketToken = 'qrcode:' + barcode.content;
 
     const text = pdf.pages[barcode.location].text;
-    const data = text.match(/(#O\d{10}-\d{5})\n(.*)\n(.*)\nEvent taking place ([\S\s]*)\.\nFrom: .*, (\S+ \d{2}, \d{4}, \d{1,2}:\d\d:\d\d [AP]M).*\nTo: .* (\S+ \d{2}, \d{4}, \d{1,2}:\d\d:\d\d [AP]M)/);
+    const data = text.match(/(#O\d{10}-\d{5})\n+(.*)\n+(.*)\n+Event taking place ([\S\s]*)\.\n+From: .*, (\S+ \d{2}, \d{4}, \d{1,2}:\d\d:\d\d [AP]M).*\n+To: .* (\S+ \d{2}, \d{4}, \d{1,2}:\d\d:\d\d [AP]M)/);
     res.reservationNumber = data[1];
     res.reservationFor.name = data[2];
     res.reservedTicket.name = data[3];
diff --git a/src/lib/scripts/flixbus.js b/src/lib/scripts/flixbus.js
index 37937b531..666255e09 100644
--- a/src/lib/scripts/flixbus.js
+++ b/src/lib/scripts/flixbus.js
@@ -62,8 +62,8 @@ function parsePdfTicket(pdf, node, triggerNode)
     let idxStations = 0;
     let reservations = [];
     while (true) {
-        const times = timeColumn.substr(idxTime).match(/(\d\d:\d\d)\n([^:]*?\n)?([^:]*?\n)?(\d\d:\d\d)/);
-        const stations = stationColumn.substr(idxStations).match(/(?:\n|^)([^].*)\n[ ]+(.*)(?:\n|(,?\n  +.*)\n)(?:.*(?:NOTE:|Wagennummerierung|platform|The regional part|Die Bussteignummer|Operated|Platform).(?:.*\n)+?)?.*(?:Bus|Autobus|Zug|Strecke|Route|Tratta)\s+(\S.+)\n.*(?:Direction|à destination de|Kierunek|richting|Richtung|Direzione) (.*)\n(?:.*(?:Operated|Betrieben|Uitgevoerd|Effettuata).*\n(?:.*Lda\.\n)?)?(.*)\n(?:[ ]+(.*?)(?:\n|(,\n +.*)\n))?/);
+        const times = timeColumn.substr(idxTime).match(/(\d\d:\d\d)\n+([^:]*?\n)?([^:]*?\n)?(\d\d:\d\d)/);
+        const stations = stationColumn.substr(idxStations).match(/(?:\n|^)([^].*)\n[ ]+(.*)(?:\n+|(,?\n+  +.*)\n+)(?:.*(?:NOTE:|Wagennummerierung|platform|The regional part|Die Bussteignummer|Operated|Platform).(?:.*\n+)+?)?.*(?:Bus|Autobus|Zug|Strecke|Route|Tratta)\s+(\S.+)\n+.*(?:Direction|à destination de|Kierunek|richting|Richtung|Direzione) (.*)\n+(?:.*(?:Operated|Betrieben|Uitgevoerd|Effettuata).*\n+(?:.*Lda\.\n+)?)?(.*)\n+(?:[ ]+(.*?)(?:\n+|(,\n +.*)\n+))?/);
         if (!times || !stations) {
             break;
         }
diff --git a/src/lib/scripts/globtour.js b/src/lib/scripts/globtour.js
index 5b4cf0cf4..81afd6bd2 100644
--- a/src/lib/scripts/globtour.js
+++ b/src/lib/scripts/globtour.js
@@ -3,11 +3,10 @@
 
 function extractTicket(pdf, node, barcode) {
     const text = pdf.pages[barcode.location].text;
-    console.log(text);
     let res = JsonLd.newBusReservation();
     res.reservationNumber = text.match(/Booking Number (.*?)  /)[1];
-    res.reservationFor.provider.name = text.match(/operated by:\n(.*)/)[1];
-    const leg = text.match(/(\d{2}\. \S+\. \d{4}, \d\d:\d\d) *\| *(.*)\n.*\n *(\d{2}\. \S+\. \d{4}, \d\d:\d\d) *\| *(.*)\n/);
+    res.reservationFor.provider.name = text.match(/operated by:\n+(.*)/)[1];
+    const leg = text.match(/(\d{2}\. \S+\. \d{4}, \d\d:\d\d) *\| *(.*)\n.*\n+ *(\d{2}\. \S+\. \d{4}, \d\d:\d\d) *\| *(.*)\n/);
     res.reservationFor.departureTime = JsonLd.toDateTime(leg[1], "dd. MMM. yyyy, HH:mm", "en");
     res.reservationFor.departureBusStop.name = leg[2];
     res.reservationFor.arrivalTime = JsonLd.toDateTime(leg[3], "dd. MMM. yyyy, HH:mm", "en");
diff --git a/src/lib/scripts/grimaldi-lines.js b/src/lib/scripts/grimaldi-lines.js
index e0870b6a3..582411db2 100644
--- a/src/lib/scripts/grimaldi-lines.js
+++ b/src/lib/scripts/grimaldi-lines.js
@@ -19,7 +19,7 @@ function parsePdfTicket(pdf, node, triggerNode) {
     let reservations = [res];
     let tokenPrefix = 10001;
     while (true) {
-        const pas = text.substr(idx).match(/  +(\S.*\S)  +[MF]  +\d\d-\d\d-\d{4}\n/);
+        const pas = text.substr(idx).match(/  +(\S.*\S)  +[MF]  +\d\d-\d\d-\d{4}\n?/);
         if (!pas)
             break;
         idx += pas.index + pas[0].length;
diff --git a/src/lib/scripts/iberia.js b/src/lib/scripts/iberia.js
index fd189cfb5..a435c44b8 100644
--- a/src/lib/scripts/iberia.js
+++ b/src/lib/scripts/iberia.js
@@ -7,13 +7,13 @@
 function main(text) {
     var reservations = new Array();
 
-    var bookingRef = text.match(/Booking code\n.*([0-9A-z]{6})\n/);
+    var bookingRef = text.match(/Booking code\n+.*([0-9A-z]{6})\n/);
     if (!bookingRef)
         return reservations;
 
     var pos = bookingRef.index + bookingRef[0].length;
     while (true) {
-        var firstLine = text.substr(pos).match(/From +([A-Z]{2})(\d{2,4}) +(\d{1,2}-\w{3}) +(\d{1,2}-\w{3}).*\n/);
+        const firstLine = text.substr(pos).match(/From +([A-Z]{2})(\d{2,4}) +(\d{1,2}-\w{3}) +(\d{1,2}-\w{3}).*\n/);
         if (!firstLine)
             break;
         var index = firstLine.index + firstLine[0].length;
@@ -23,7 +23,7 @@ function main(text) {
         res.reservationFor.flightNumber = firstLine[2];
         res.reservationFor.airline.iataCode = firstLine[1];
 
-        var secondLine = text.substr(pos + index).match(/^ (\w+) \(([A-Z]{3})\) +(\d{2}:\d{2}) + (\d{2}:\d{2}) .*\n/);
+        const secondLine = text.substr(pos + index).match(/^ *(\w+) \(([A-Z]{3})\) +(\d{2}:\d{2}) + (\d{2}:\d{2}) .*\n/);
         if (!secondLine)
             break;
         index += secondLine.index + secondLine[0].length;
@@ -33,7 +33,7 @@ function main(text) {
         res.reservationFor.departureTime = JsonLd.toDateTime(firstLine[3] + " " + secondLine[3], "dd-MMM hh:mm", "en");
         res.reservationFor.arrivalTime = JsonLd.toDateTime(firstLine[4] + " " + secondLine[4], "dd-MMM hh:mm", "en");
 
-        var fourthLine = text.substr(pos + index).match(/^.*\n (\w+) \(([A-Z]{3})\) .*\n/);
+        const fourthLine = text.substr(pos + index).match(/^.*\n *(\w+) \(([A-Z]{3})\) .*\n/);
         if (!fourthLine)
             break;
         index += fourthLine.index + fourthLine[0].length;
@@ -63,7 +63,7 @@ function extractBoardingPass(pdf, node, barcode)
     const times = text.match(/\d\d \S+ (\d\d:\d\d) +(?:\d\d \S+)? (\d\d:\d\d)/);
     res.reservationFor.departureTime = JsonLd.toDateTime(times[1], 'hh:mm', 'en');
     res.reservationFor.arrivalTime = JsonLd.toDateTime(times[2], 'hh:mm', 'en');
-    const boarding = text.match(/(?:SEAT|ASIENTO)\n *(\d\d:\d\d) (?:GRUPO (\S*))?/);
+    const boarding = text.match(/(?:SEAT|ASIENTO)\n+ *(\d\d:\d\d) (?:GRUPO (\S*))?/);
     res.reservationFor.boardingTime = JsonLd.toDateTime(boarding[1], 'hh:mm', 'en');
     res.boardingGroup = boarding[2];
     return res;
@@ -85,7 +85,7 @@ function extractReservation(pdf)
     let reservations = [];
     let idx = 0;
     while (true) {
-        const flight = text.substr(idx).match(/ ([A-Z0-9]{2})(\d{1,4}) .* (\d{4}).*? ([A-Z, ]+), [0-9A-Z]{2}\n.*: (\S.*\S), ([A-Z]{3})\((.*)\) +(\d.*)\n.*: (\S.*\S), ([A-Z]{3})\((.*)\) +(\d.*)\n/);
+        const flight = text.substr(idx).match(/ ([A-Z0-9]{2})(\d{1,4}) .* (\d{4}).*? ([A-Z, ]+), [0-9A-Z]{2}\n+.*: (\S.*\S), ([A-Z]{3})\((.*)\) +(\d.*)\n+.*: (\S.*\S), ([A-Z]{3})\((.*)\) +(\d.*)\n/);
         if (!flight)
             break;
         idx += flight.index + flight[0].length;
diff --git a/src/lib/scripts/ltg-link.js b/src/lib/scripts/ltg-link.js
index 297e07f93..eb2d58c94 100644
--- a/src/lib/scripts/ltg-link.js
+++ b/src/lib/scripts/ltg-link.js
@@ -14,7 +14,7 @@ function parsePdfTicket(pdf, node, triggerNode) {
     const dt = text.match(/(\d{4}-\d\d-\d\d)(?:\n.*){1,2}(\d\d:\d\d) - (\d\d:\d\d)/);
     res.reservationFor.departureTime = JsonLd.toDateTime(dt[1] + ' ' + dt[2], 'yyyy-MM-dd hh:mm', 'lt');
     res.reservationFor.arrivalTime = JsonLd.toDateTime(dt[1] + ' ' + dt[3], 'yyyy-MM-dd hh:mm', 'lt');
-    const train = text.match(/SEAT\n *(\S.*?)  +(\S.*?)  +(\S.*?)  +(\S.*)\n/);
+    const train = text.match(/SEAT\n+ *(\S.*?)  +(\S.*?)  +(\S.*?)  +(\S.*)\n/);
     res.reservationFor.trainNumber = train[1];
     res.reservedTicket.ticketedSeat.seatingType = train[2];
     res.reservedTicket.ticketedSeat.seatSection = train[3];
diff --git a/src/lib/scripts/lufthansa.js b/src/lib/scripts/lufthansa.js
index 13f892a2d..fd64bd6c7 100644
--- a/src/lib/scripts/lufthansa.js
+++ b/src/lib/scripts/lufthansa.js
@@ -32,7 +32,7 @@ function extractBoardingPass(iata, node, pdfNode) {
 
     // new? 2025 multi-column layout
     const rightCol = page.textInRect(0.80, 0.0, 1.0, 1.0);
-    let boarding = rightCol.match(/Group\n(.*)\n *Boarding\n *(\d\d:\d\d)\n/);
+    let boarding = rightCol.match(/Group\n+(.*)\n+ *Boarding\n+ *(\d\d:\d\d)\n/);
     if (boarding) {
         res.boardingGroup = boarding[1];
         res.reservationFor.boardingTime = JsonLd.toDateTime(boarding[2], 'hh:mm', 'en');
@@ -43,7 +43,7 @@ function extractBoardingPass(iata, node, pdfNode) {
         res.reservationFor.arrivalTime = JsonLd.toDateTime(times[2], 'hh:mm', 'en');
 
         const midCol = page.textInRect(0.65, 0.0, 0.8, 1.0);
-        const dep = midCol.match(/Terminal\n *(.*)\n *Gate\n *(.*)\n/);
+        const dep = midCol.match(/Terminal\n+ *(.*)\n+ *Gate\n+ *(.*)\n/);
         if (dep) {
             res.reservationFor.departureTerminal = dep[1];
             res.reservationFor.departureGate = dep[2];
diff --git a/src/lib/scripts/nationalrail.js b/src/lib/scripts/nationalrail.js
index 99bce9ade..f65e2e98b 100644
--- a/src/lib/scripts/nationalrail.js
+++ b/src/lib/scripts/nationalrail.js
@@ -106,7 +106,7 @@ function parseTicket(pdf, node, triggerNode) {
         res = JsonLd.newTrainReservation();
         res.reservedTicket.ticketToken = 'azteccode:' + triggerNode.content;
     }
-    const header = text.match(/ +(\d{2}[ -][A-Z][a-z]{2}[ -]\d{4}) +(?:Out: |Ret: )?([A-Z]{3}) ?- ?([A-Z]{3})\n(.*)  +(.*)/);
+    const header = text.match(/ +(\d{2}[ -][A-Z][a-z]{2}[ -]\d{4}) +(?:Out: |Ret: )?([A-Z]{3}) ?- ?([A-Z]{3})\n+(.*)  +(.*)/);
     const date = header[1].replace(/-/g, ' ');
     const itinerary = text.match(/Itinerary.*\n["⃝ ]+(.*)\n +(\d{2}:\d{2})\n +([\S\s]*?)\n +(\d{2}:\d{2})\n["⃝ ]+(.*)/);
 
diff --git a/src/lib/scripts/ouigo-es.js b/src/lib/scripts/ouigo-es.js
index 488ba504a..4b14a557f 100644
--- a/src/lib/scripts/ouigo-es.js
+++ b/src/lib/scripts/ouigo-es.js
@@ -29,20 +29,20 @@ function parsePdf(pdf, node, triggerNode) {
     let res = triggerNode.result[0];
 
     const topLeft = page.textInRect(0.0, 0.0, 0.5, 0.5);
-    const stations = topLeft.match(/\n(.*)\n\d\d:\d\d\n(.*)\n(\d\d:\d\d)/);
+    const stations = topLeft.match(/\n(.*)\n\d\d:\d\d\n+(.*)\n(\d\d:\d\d)/);
     if (stations) {
         res.reservationFor.departureStation.name = stations[1];
         res.reservationFor.arrivalStation.name = stations[2];
         res.reservationFor.arrivalTime = JsonLd.toDateTime(stations[3], "hh:mm", "es");
     } else {
-        const stationsV2 = topLeft.match(/\n* \d\d:\d\d\n(.*)\n *(\d\d:\d\d)\n(.*)/);
+        const stationsV2 = topLeft.match(/\n* \d\d:\d\d\n+(.*)\n+ *(\d\d:\d\d)\n+(.*)/);
         res.reservationFor.departureStation.name = stationsV2[1];
         res.reservationFor.arrivalStation.name = stationsV2[3];
         res.reservationFor.arrivalTime = JsonLd.toDateTime(stationsV2[2], "hh:mm", "es");
     }
 
     const topRight = page.textInRect(0.5, 0.0, 1.0, 0.5);
-    const name = page.text.match(/^ *Localizador: .*\n(.*)\n/);
+    const name = page.text.match(/^ *Localizador: .*\n+(.*)\n/);
     if (name)
         res.underName.name = name[1];
     else
diff --git a/src/lib/scripts/pasazieru-vilciens.js b/src/lib/scripts/pasazieru-vilciens.js
index fce52a8f3..157983774 100644
--- a/src/lib/scripts/pasazieru-vilciens.js
+++ b/src/lib/scripts/pasazieru-vilciens.js
@@ -10,7 +10,7 @@ function parseOnePdfTicket(text) {
         return;
     res.reservedTicket.ticketToken = 'qrcode:' + header[2];
     res.reservedTicket.name = header[1] + header[3];
-    const trip = text.match(/(.*)  +(\d\d:\d\d) +(.*)  +(\d\d:\d\d)\n.* (\d{1,5})  +.*(\d\d\.\d\d.\d{4})/);
+    const trip = text.match(/(.*)  +(\d\d:\d\d) +(.*)  +(\d\d:\d\d)\n+.* (\d{1,5})  +.*(\d\d\.\d\d.\d{4})/);
     res.reservationFor.departureStation.name = trip[1];
     res.reservationFor.arrivalStation.name = trip[3];
     res.reservationFor.arrivalTime = JsonLd.toDateTime(trip[6] + ' ' + trip[4], 'dd.MM.yyyy hh:mm', 'lv');
@@ -22,7 +22,7 @@ function parseOnePdfTicket(text) {
 
 function parseOnePdfTicketVivi(text) {
     let res = JsonLd.newTrainReservation();
-    const data = text.match(/(\S.*\S)\n.*\n *(\S.*\S)  +(\S.*\S)  +(\d+)\n.*\n *(\d{2}:\d{2})  +(\d{2}:\d{2})  +(\d{2}\.\d{2}\.\d{4})/);
+    const data = text.match(/(\S.*\S)\n.*\n+ *(\S.*\S)  +(\S.*\S)  +(\d+)\n.*\n+ *(\d{2}:\d{2})  +(\d{2}:\d{2})  +(\d{2}\.\d{2}\.\d{4})/);
     if (!data)
         return;
     res.reservedTicket.name = data[1];
diff --git a/src/lib/scripts/pretix.js b/src/lib/scripts/pretix.js
index a62bbfe96..31d9f717b 100644
--- a/src/lib/scripts/pretix.js
+++ b/src/lib/scripts/pretix.js
@@ -50,13 +50,13 @@ function parsePass(content, node) {
 function parsePdfPage(pdf, page, barcode) {
     let res = JsonLd.newEventReservation();
     const text = pdf.pages[page].textInRect(0.0, 0.0, 1.0, 0.4);
-    const dt = text.match(/(\d{4}.\d\d.\d\d \d\d:\d\d|\d\d.\d\d.\d{4} \d\d:\d\d|\d{1,2}\. \S+ \d{4})\n/);
+    const dt = text.match(/(\d{4}.\d\d.\d\d \d\d:\d\d|\d\d.\d\d.\d{4} \d\d:\d\d|\d{1,2}\. \S+ \d{4})/);
     res.reservationFor.startDate = JsonLd.toDateTime(dt[1], ['dd.MM.yyyy hh:mm', 'yyyy-MM-dd hh:mm', 'dd. MMMM yyyy'], ['en', 'de']);
 
-    const data1 = text.substr(0, dt.index).trim().split(/\n/);
+    const data1 = text.substr(0, dt.index).trim().split(/\n+/);
     res.reservationFor.name = data1.slice(0, Math.max(data1.length - 2, 1)).join(' ');
 
-    const data2 = text.substr(dt.index + dt[0].length).trim().split(/\n/);
+    const data2 = text.substr(dt.index + dt[0].length).trim().split(/\n+/);
     if (data2 && data2.length > 0 && data2[0]) {
         res.reservationFor.location.name = data2.slice(0, data2.length - 1).join(' ');
         res.reservationNumber = data2[data2.length - 1].match(/(\S+) /)[1];
diff --git a/src/lib/scripts/sas-boardingpass.js b/src/lib/scripts/sas-boardingpass.js
index 802ee0a5d..29a78b352 100644
--- a/src/lib/scripts/sas-boardingpass.js
+++ b/src/lib/scripts/sas-boardingpass.js
@@ -21,7 +21,7 @@ function main(pdf, node, triggerNode) {
     if (!text.match(/BOARDING PASS/))
         return null;
 
-    var lines = text.split('\n');
+    const lines = text.split(/\n+/);
 
     var state = 0;
     var flights = [];
diff --git a/src/lib/scripts/sas-receipt.js b/src/lib/scripts/sas-receipt.js
index ffafaf19b..7a654a033 100644
--- a/src/lib/scripts/sas-receipt.js
+++ b/src/lib/scripts/sas-receipt.js
@@ -17,7 +17,7 @@ function extractInformation(page) {
     var text = page.textInRect(0, 0, 1, 1);
     if (text.match(/\s+Electronic Ticket Itinerary and Receipt/)) {
         var res = new Array();
-        var lines = text.split("\n");
+        var lines = text.split(/\n+/);
         var lastFlight = null;
         var bookingRef = text.match(/Booking Reference:\s* ([A-Z0-9]+)\s/);
         var issueDate = text.match(/.*Date of Issue:\s([0-9A-Z]+)/);
diff --git a/src/lib/scripts/scandlines.js b/src/lib/scripts/scandlines.js
index a2fb07b02..0f83d5800 100644
--- a/src/lib/scripts/scandlines.js
+++ b/src/lib/scripts/scandlines.js
@@ -2,7 +2,6 @@
 // SPDX-License-Identifier: LGPL-2.0-or-later
 
 function extractPdf(pdf, node, barcode) {
-    console.log(pdf);
     const text = pdf.text;
     let idx = 0;
     let reservations = [];
@@ -10,7 +9,6 @@ function extractPdf(pdf, node, barcode) {
         const trip = text.substr(idx).match(/:  +(\S.*\S)  +.*:  +(\d{2}.\d{2}.\d{4} \d\d:\d\d)\n.*:  +(\S.*\S)  +.*:  +(\d{2}.\d{2}.\d{4} \d\d:\d\d)\n/);
         if (!trip)
             break;
-        console.log(trip);
         idx += trip.index + trip[0].length;
 
         let res = JsonLd.newBoatReservation();
diff --git a/src/lib/scripts/sncf.js b/src/lib/scripts/sncf.js
index 1ce9b8cc1..1d743efb4 100644
--- a/src/lib/scripts/sncf.js
+++ b/src/lib/scripts/sncf.js
@@ -215,11 +215,11 @@ function parseSecutixPdfItineraryV1(text, res)
     var reservations = new Array();
     var pos = 0;
     while (true) {
-        var dep = text.substr(pos).match(/Départ [^ ]+ (\d+\.\d+\.\d+) à (\d+:\d+) [^ ]+ (.*)\n/);
+        const dep = text.substr(pos).match(/Départ \S+ (\d+\.\d+\.\d+) à (\d+:\d+) \S+ (.*)\n/);
         if (!dep)
             break;
         pos += dep.index + dep[0].length;
-        var arr = text.substr(pos).match(/Arrivée [^ ]+ (\d+\.\d+\.\d+) à (\d+:\d+) [^ ]+ (.*)\n\s+(.*)\n/);
+        const arr = text.substr(pos).match(/Arrivée \S+ (\d+\.\d+\.\d+) à (\d+:\d+) \S+ (.*)\n\s*(.*)/);
         if (!arr)
             break;
         pos += arr.index + arr[0].length;
@@ -245,7 +245,7 @@ function parseSecutixPdfItineraryV2(text, res)
     let reservations = [];
     let pos = 0;
     while (true) {
-        const trip = text.substr(pos).match(/ *(\d\dh\d\d)\n(.*)\n(.*)\n([\S\s]*?) *(\d\dh\d\d)\n(.*)\n/);
+        const trip = text.substr(pos).match(/ *(\d\dh\d\d)\n(.*)\n+(.*)\n+([\S\s]*?) *(\d\dh\d\d)\n(.*)\n/);
         if (!trip)
             break;
         pos += trip.index + trip[0].length;
diff --git a/src/lib/scripts/tcdd.js b/src/lib/scripts/tcdd.js
index e764d2658..896b3a491 100644
--- a/src/lib/scripts/tcdd.js
+++ b/src/lib/scripts/tcdd.js
@@ -9,11 +9,11 @@ function parsePdfTicket(pdf, node, triggerNode) {
 
     const text = pdf.pages[triggerNode.location].text;
 
-    const stationMatch = text.match(/Nereden From +Nereye To\n +(.+?) {3,}(.+?) {3,}/);
+    const stationMatch = text.match(/Nereden From +Nereye To\n+ +(.+?) {3,}(.+?) {3,}/);
     res.reservationFor.departureStation.name = stationMatch[1];
     res.reservationFor.arrivalStation.name = stationMatch[2];
 
-    const passengerMatch = text.match(/Yolcu +Passenger\n +_+ +(.+?)\(([EK])\)/);
+    const passengerMatch = text.match(/Yolcu +Passenger\n+ +_+ +(.+?)\(([EK])\)/);
     res.underName.name = passengerMatch[1];
     // E = erkek/man, K = kadın/woman, no other option as of 2024
     const gender = passengerMatch[2];
diff --git a/src/lib/scripts/thalys.js b/src/lib/scripts/thalys.js
index e2fbc8bc7..c6e515493 100644
--- a/src/lib/scripts/thalys.js
+++ b/src/lib/scripts/thalys.js
@@ -72,7 +72,7 @@ function parsePdfTicket(pdf, node, triggerNode)
     res.reservationFor.arrivalStation.name = arr[1];
     res.reservationFor.arrivalTime = res.reservationFor.departureDay.substr(0, 11) + arr[2];
 
-    const passenger = page.textInRect(0.0, 0.0, 0.35, 0.1).match(/(?:PASSAGER|FAHRGAST|PASSENGER|REIZIGER)\n(.*)\n/);
+    const passenger = page.textInRect(0.0, 0.0, 0.35, 0.1).match(/(?:PASSAGER|FAHRGAST|PASSENGER|REIZIGER)\n+ *(\S.*)/);
     res.underName.name = passenger[1];
     res.reservationNumber = page.textInRect(0.8, 0.0, 1.0,  0.2).match(/PNR\n([A-Z0-9]+)/)[1];
 
diff --git a/src/lib/scripts/ticketmaster.js b/src/lib/scripts/ticketmaster.js
index ea87dac32..f6eb2fda5 100644
--- a/src/lib/scripts/ticketmaster.js
+++ b/src/lib/scripts/ticketmaster.js
@@ -11,8 +11,8 @@ function parsePdfTicket(pdf, node) {
         res.reservationNumber = text.match(/Auftragsnummer:\s*(\d+)/)[1];
         const name = text.match(/gekauft von:.*\n\s*\d.*\d\s*(\S.*)\n/);
         res.underName.name = name[1];
-        res.reservationFor.name = text.substr(name.index + name[0].length).match(/(.*)\n/)[1];
-        const venue = text.match(/Veranstalter:\n.*\n(.*)\n(.*?)(?:  .*)?\n(.*)\n/);
+        res.reservationFor.name = text.substr(name.index + name[0].length).match(/(\S.*)\n/)[1];
+        const venue = text.match(/Veranstalter:\n.*\n+(.*)\n(.*?)(?:  .*)?\n(.*)\n/);
         res.reservationFor.location.name = venue[1];
         res.reservationFor.location.address.streetAddress = venue[2];
         res.reservationFor.location.address.addressLocality = venue[3];
diff --git a/src/lib/scripts/tito.js b/src/lib/scripts/tito.js
index 3570b4dbf..df704ee70 100644
--- a/src/lib/scripts/tito.js
+++ b/src/lib/scripts/tito.js
@@ -40,7 +40,7 @@ function extractPass(pass, node) {
 function extractPdf(pdf, node, barcode) {
     const page = pdf.pages[barcode.location];
     const topRight = page.textInRect(0.5, 0.0, 1.0, 0.5);
-    const ev = topRight.match(/([\S\s]+)\n(.*,(?: |\n *)\d{4})\n(?:\s*\d{1,2}:\d{2}[ap]m.*\n)?([\S\s]+)/);
+    const ev = topRight.match(/([\S\s]+)\n(.*,(?: |\n *)\d{4})\n(?:\s*\d{1,2}:\d{2}[ap]m.*\n+)?([\S\s]+)/);
 
     let res = JsonLd.newEventReservation();
     res.reservationFor.name = ev[1];
@@ -48,12 +48,12 @@ function extractPdf(pdf, node, barcode) {
     res.reservedTicket.ticketToken = 'qrCode:' + barcode.content;
 
     const left = page.textInRect(0.0, 0.0, 0.5, 1.0);
-    const dt = left.match(/(.*, \d{4})\nTICKET HOLDER\n(.*)\n/);
+    const dt = left.match(/(.*, \d{4})\n+TICKET HOLDER\n(.*)\n/);
     parseDate(res, dt[1]);
     res.underName.name = dt[2];
     res.reservationNumber = left.match(/REFERENCE\n(.*)\n/)[1];
     res.reservedTicket.name = left.match(/TICKET\n(.*)\n/)[1];
-    const org = left.match(/EVENT HOMEPAGE\n *([\S\s]+)\n.*EMAIL\n *(\S.*)\n/);
+    const org = left.match(/EVENT HOMEPAGE\n *([\S\s]+)\n.*EMAIL\n *(\S.*)/);
     res.reservationFor.url = org[1].replace(/\n */, '');
     res.provider = { '@type': 'Organization', email: org[2] };
     return res;
diff --git a/src/lib/scripts/tobilet.js b/src/lib/scripts/tobilet.js
index bd457ee4d..fd8f1af19 100644
--- a/src/lib/scripts/tobilet.js
+++ b/src/lib/scripts/tobilet.js
@@ -3,10 +3,9 @@
 
 function extractPdf(pdf, node, triggerNode) {
     const text = pdf.pages[triggerNode.location].text;
-    console.log(text);
 
     let res = JsonLd.newEventReservation();
-    const ev = text.match(/(.*)\n(\d{4}\.\d{2}\.\d{2}) - (\d{4}\.\d{2}\.\d{2})\n.*?: (.*)\n.*?: (.*)\n/);
+    const ev = text.match(/(.*)\n+(\d{4}\.\d{2}\.\d{2}) - (\d{4}\.\d{2}\.\d{2})\n+.*?: (.*)\n+.*?: (.*)\n/);
 
     res.reservationFor.name = ev[1];
     res.reservationFor.startDate = JsonLd.toDateTime(ev[2], "yyyy.MM.dd", "pl");
diff --git a/src/lib/scripts/trenitalia.js b/src/lib/scripts/trenitalia.js
index beb742350..40e60cbf4 100644
--- a/src/lib/scripts/trenitalia.js
+++ b/src/lib/scripts/trenitalia.js
@@ -86,8 +86,7 @@ function parsePdf(pdf, node) {
         let j = 0;
         while(true) {
             let personalRes = JsonLd.clone(res);
-            var name = passengerColumn.substr(offset).match(/(?:Passenger Name|Nome Passeggero|Nom du Passager|Passagiername)(?:\/Passenger\n *name)?.*\n(?:    .*\n)* *((?:\w+|\-\-).*?)(?:  |\n)/);
-            console.log(name);
+            const name = passengerColumn.substr(offset).match(/(?:Passenger Name|Nome Passeggero|Nom du Passager|Passagiername)(?:\/Passenger\n *name)?.*\n+(?:    .*\n)* *((?:\w+|\-\-).*?)(?:  |\n)/);
             if (!name)
                 break;
             offset += name.index + name[0].length;
diff --git a/src/lib/scripts/viarail.js b/src/lib/scripts/viarail.js
index 1f20cde50..07c0db0e9 100644
--- a/src/lib/scripts/viarail.js
+++ b/src/lib/scripts/viarail.js
@@ -43,12 +43,11 @@ function parseBarcode(barcode) {
 function parseBoardingPass(pdf, node, triggerNode) {
     var res = node.result[0];
     const text = pdf.pages[triggerNode.location].text;
-    const stationNames = text.match(/FTR\s*:\s*\d+\n(.*)   +(.*)\n/);
+    const stationNames = text.match(/FTR\s*:\s*\d+\n+(.*)   +(.*)\n/);
     res.reservationFor.departureStation.name = stationNames[1];
     res.reservationFor.arrivalStation.name = stationNames[2];
     const arrivalDate = text.match(/Date\s*:.*Date\s*:\s*\w+\.\s*(.*)\n/);
     const arrivalTime = text.match(/Arrival\s*:\s*(.*)\n/);
-    console.log(arrivalDate[1] + ' ' + arrivalTime[1]);
     res.reservationFor.arrivalTime = JsonLd.toDateTime(arrivalDate[1] + ' ' + arrivalTime[1], 'MMM d, yyyy HH:mm AP', 'en');
     return res;
 }
diff --git a/src/lib/scripts/vistara.js b/src/lib/scripts/vistara.js
index 86d2d3189..97e760d3f 100644
--- a/src/lib/scripts/vistara.js
+++ b/src/lib/scripts/vistara.js
@@ -7,9 +7,9 @@ function parseBoardingPass(pdf, node, triggerNode) {
     if (triggerNode.result.length != 1) return;
     const page = pdf.pages[triggerNode.location];
     const depText = page.textInRect(0.0, 0.2, 0.5, 0.4);
-    const dep = depText.match(/DEPARTURE\n *(\d{4})\n *(\d{2}\w{3}\d{4})\n(.*\n)?(.*)\nFLIGHT/);
+    const dep = depText.match(/DEPARTURE\n+ *(\d{4})\n+ *(\d{2}\w{3}\d{4})\n+(.*\n+)?(.*)\n+FLIGHT/);
     const arrText = page.textInRect(0.5, 0.2, 1.0, 0.4);
-    const arr = arrText.match(/ *ARRIVAL\n *(\d{4})\n *(\d{2}\w{3}\d{4})\n(.*\n)?(.*)\n *BOARDING TIME .*\n *(\d{4})/);
+    const arr = arrText.match(/ *ARRIVAL\n+ *(\d{4})\n+ *(\d{2}\w{3}\d{4})\n(.*\n)?(.*)\n+ *BOARDING TIME .*\n+ *(\d{4})/);
 
     let res = triggerNode.result[0];
     res.reservationFor.departureAirport.name = dep[4];
@@ -18,7 +18,7 @@ function parseBoardingPass(pdf, node, triggerNode) {
 
     res.reservationFor.arrivalAirport.name = arr[4];
     res.reservationFor.arrivalTime = JsonLd.toDateTime(arr[2] + ' ' + arr[1], 'ddMMMyyyy hhmm', 'en');
-    res.reservationFor.arrivalTerminal = arr[3];
+    res.reservationFor.arrivalTerminal = arr[3]?.trim();
 
     res.reservationFor.boardingTime = JsonLd.toDateTime(dep[2] + ' ' + arr[5], 'ddMMMyyyy hhmm', 'en');
     return res;
diff --git a/src/lib/scripts/vr.fi.js b/src/lib/scripts/vr.fi.js
index 87afc47db..217910f3c 100644
--- a/src/lib/scripts/vr.fi.js
+++ b/src/lib/scripts/vr.fi.js
@@ -63,7 +63,7 @@ function parseTicket(pdf, node, trigger) {
 function parseMobilePdf(pdf, node, ssb) {
     let res = ssb.result[0];
     const text = pdf.pages[ssb.location].textInRect(0.0, 0.0, 0.5, 0.5);
-    const trip = text.match(/(\d{1,2}\.\d{1,2}\.\d{4})\n *(\S.*\S)  +(\S.*)\n *(\d\d:\d\d)  +(\d\d:\d\d)\n/);
+    const trip = text.match(/(\d{1,2}\.\d{1,2}\.\d{4})\n+ *(\S.*\S)  +(\S.*)\n+ *(\d\d:\d\d)  +(\d\d:\d\d)\n/);
     res.reservationFor.departureTime = JsonLd.toDateTime(trip[4], "hh:mm", "en");
     res.reservationFor.arrivalTime = JsonLd.toDateTime(trip[5], "hh:mm", "en");
     res.reservationFor.departureStation.name = trip[2];
-- 
GitLab

