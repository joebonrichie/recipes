From 21d7fedaaab6b2d840c276259072be393b32a499 Mon Sep 17 00:00:00 2001
From: Volker Krause <vkrause@kde.org>
Date: Mon, 29 Dec 2025 17:55:27 +0100
Subject: [PATCH] Adapt to Poppler 26.01 API changes

---
 src/lib/pdf/pdfimage.cpp | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/src/lib/pdf/pdfimage.cpp b/src/lib/pdf/pdfimage.cpp
index 2a0cd55ab..2723f48c9 100644
--- a/src/lib/pdf/pdfimage.cpp
+++ b/src/lib/pdf/pdfimage.cpp
@@ -34,7 +34,11 @@ QImage PdfImagePrivate::load(Stream* str, GfxImageColorMap* colorMap)
 {
     if (m_format == QImage::Format_Mono) { // bitmasks are not stored as image streams
         auto img = QImage(m_sourceWidth, m_sourceHeight, QImage::Format_Mono); // TODO implicit Format_Grayscale8 conversion
+#if KPOPPLER_VERSION < QT_VERSION_CHECK(25, 12, 90)
         str->reset();
+#else
+        str->rewind();
+#endif
         const int rowSize = (m_sourceWidth + 7) / 8;
         for (int y = 0; y < m_sourceHeight; ++y) {
             auto imgData = img.scanLine(y);
@@ -55,7 +59,11 @@ QImage PdfImagePrivate::load(Stream* str, GfxImageColorMap* colorMap)
     auto img = QImage(m_sourceWidth, m_sourceHeight, (m_loadingHints & PdfImage::ConvertToGrayscaleHint) ? QImage::Format_Grayscale8 : m_format);
     const auto bytesPerPixel = colorMap->getNumPixelComps();
     std::unique_ptr<ImageStream> imgStream(new ImageStream(str, m_sourceWidth, bytesPerPixel, colorMap->getBits()));
+#if KPOPPLER_VERSION <QT_VERSION_CHECK(25, 12, 90)
     imgStream->reset();
+#else
+    imgStream->rewind();
+#endif
 
     switch (m_format) {
         case QImage::Format_RGB888:
-- 
GitLab

