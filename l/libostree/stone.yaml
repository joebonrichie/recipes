#
# SPDX-FileCopyrightText: © 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : libostree
version     : "2025.7"
release     : 15
homepage    : https://ostreedev.github.io/ostree/
upstreams   :
    - https://github.com/ostreedev/ostree/releases/download/v2025.7/libostree-2025.7.tar.xz : af8d080b9585e7fd1faba8f022967e1c268ae62e20ecf32ee7b364c1e307570b
summary     : Operating system and container binary deployment and upgrades
description : |
    The core OSTree model is like git in that it checksums individual files and has a content-addressed-object store. It's unlike git in that it "checks out" the files via hardlinks, and they thus need to be immutable to prevent corruption. Therefore, another way to think of OSTree is that it's just a more polished version of Linux VServer hardlinks.

    Features:
    - Transactional upgrades and rollback for the system
    - Replicating content incrementally over HTTP via GPG signatures and “pinned TLS” support
    - Support for parallel installing more than just 2 bootable roots
    - Binary history on the server side (and client)
    - Introspectable shared library API for build and deployment systems
    - Flexible support for multiple branches and repositories, supporting projects like Flatpak which use libostree for applications, rather than hosts.
license     :
    - BSD-2-Clause
    - LGPL-2.0-or-later
    - LGPL-2.1-or-later
builddeps   :
    - binary(bison)
    - binary(gjs)
    - binary(python)
    - binary(xsltproc)
    - pkgconfig(avahi-client)
    - pkgconfig(e2p)
    - pkgconfig(fuse3)
    - pkgconfig(glib-2.0)
    - pkgconfig(gobject-introspection-1.0)
    - pkgconfig(gpgme-glib)
    - pkgconfig(libarchive)
    - pkgconfig(libcurl)
    - pkgconfig(liblzma)
    - pkgconfig(libsoup-3.0)
    - pkgconfig(libsystemd)
    - pkgconfig(openssl)
    - docbook
    - docbook-xsl
environment : |
    %export_docbook_catalogs
setup       : |
    %patch %(pkgdir)/remove-gcc-override.patch

    %configure \
        --with-curl \
        --with-crypto=openssl
build       : |
    %make
install     : |
    %make_install
    # we're not an ostree distribution
    rm -rf %(installroot)%(libdir)/systemd/
    rm -rf %(installroot)%(libdir)/tmpfiles.d

    # We don't support grub
    rm -rfv %(installroot)%(libdir)/libostree/libostree/grub2-15_ostree
    rmdir -v %(installroot)%(libdir)/libostree/libostree/ \
             %(installroot)%(libdir)/libostree/
packages    :
    - "%(name)-libs":
        paths:
            - /usr/lib/libostree-1.so.*
            - /usr/lib/girepository-1.0/OSTree-1.0.typelib
