#
# SPDX-FileCopyrightText: Â© 2020-2025 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : intel-media-driver
version     : '25.3.4' # Update-checker will return additional tags, but these are testing releases. Only use versions that are in the "releases"
release     : 4
homepage    : https://github.com/intel/media-driver
upstreams   :
    - https://github.com/intel/media-driver/archive/refs/tags/intel-media-25.3.4.tar.gz : ef9a7a0881b250d23df7d4676341a3729b28887bcf404a74d48db5f44ffa0220
summary     : VA-API driver for Intel Gen graphics
description : |
    VA-API driver for Intel Gen graphics
license     :
    - BSD-3-Clause
    - MIT
builddeps   :
    - pkgconfig(igdgmm)
    - pkgconfig(libva)
    - pkgconfig(x11)
setup       : |
    %patch %(pkgdir)/ftbfs-cmake-4.patch

    # error: variable length arrays in C++ are a Clang extension (MEDIA_BUILD_FATAL_WARNINGS=OFF)
    %cmake \
        -DMEDIA_RUN_TEST_SUITE:BOOL=False \
        -DMEDIA_BUILD_FATAL_WARNINGS=OFF
build       : |
    %cmake_build
install     : |
    %cmake_install
tuning      :
    - lto: full
    - optimize: speed
packages    :
    - "libva-intel-media-driver":
        summary: The Intel Media Driver for VAAPI
        description: The Intel Media Driver for VAAPI
        paths:
            - /usr/lib/dri
    
    - "libigfxcmrt":
        summary: Intel library to load GPU kernels
        rundeps:
            - libva-intel-media-driver
        paths:
            - /usr/lib/libigfxcmrt.so.*
    
    - "libigfxcmrt-devel":
        summary: Intel library to load GPU kernels - devel
        rundeps:
            - libigfxcmrt
        paths:
            - /usr/include/igfxcmrt/
            - /usr/lib/libigfxcmrt.so
            - /usr/lib/pkgconfig/igfxcmrt.pc
